# Backlog

Uncategorized functional requirements and user stories for future development.

Add new requirements here as they come up. They'll be categorized and prioritized later.

---

## Requirements

| # | Requirement | Added | Status |
|---|-------------|-------|--------|
| 1 | FR-8: Good Take Algorithm (see below) | 2025-11-28 | âœ… v2 Implemented 2025-11-29 |
| 2 | FR-9: Default port 5100 (see below) | 2025-11-28 | âœ… Implemented 2025-11-29 |
| 3 | FR-10: Project List Panel (see below) | 2025-11-28 | âœ… Implemented 2025-11-29 |
| 4 | FR-11: Project Selector/Switcher (see below) | 2025-11-28 | âœ… Implemented 2025-11-29 |
| 5 | FR-12: Create New Project (see below) | 2025-11-29 | âœ… Implemented 2025-11-29 |
| 6 | FR-13: Common Names Quick-Select UI (see below) | 2025-11-29 | âœ… Implemented 2025-11-29 |
| 7 | FR-14: Recordings Asset View (see below) | 2025-11-29 | âœ… Implemented 2025-11-29 |
| 8 | FR-15: Move to Safe (see below) | 2025-11-29 | âœ… Implemented 2025-11-30 |
| 9 | FR-16: Discard Remaining Files Prompt (see below) | 2025-11-29 | âœ… Implemented 2025-11-29 |
| 10 | FR-17: Image Asset Management Page (see spec) | 2025-11-29 | âœ… Implemented 2025-11-29 |
| 11 | FR-18: Image Duplicate Detection (see spec) | 2025-11-29 | âœ… Implemented 2025-11-29 |
| 12 | FR-19: Image Variant Support (A/B/C) (see spec) | 2025-11-29 | âœ… Implemented 2025-11-29 |
| 13 | UX Improvements: I-2, R-1 to R-5, P-1, P-3, C-1 to C-4 (see ux-improvements.md) | 2025-11-29 | Pending |
| 14 | FR-20: Image Quick Preview (Shift+Hover) (see below) | 2025-11-30 | âœ… Implemented 2025-11-30 |
| 15 | FR-21: Custom Tag Input (see below) | 2025-12-01 | âœ… Implemented 2025-12-01 |
| 16 | FR-22: Image Prompt Creation (see spec) | 2025-12-01 | âœ… Implemented 2025-12-01 |
| 17 | FR-23: Thumbnail Size Toggle (see below) | 2025-12-01 | âœ… Implemented 2025-12-01 |
| 18 | FR-24: Image Source Directory in Config (see below) | 2025-12-01 | âœ… Implemented 2025-12-01 |
| 19 | FR-25: Assigned Assets Row Cleanup (see below) | 2025-12-01 | âœ… Implemented 2025-12-01 |
| 20 | FR-26: Paired Asset Display with Prompt Preview (see below) | 2025-12-01 | âœ… Implemented 2025-12-01 |
| 21 | FR-27: YouTube Thumbnails Page (see spec) | 2025-12-01 | âœ… Implemented 2025-12-01 |
| 22 | FR-28: Server Connection Indicator (see below) | 2025-12-01 | âœ… Implemented 2025-12-01 |
| 23 | FR-29: Open Folder in Finder (see below) | 2025-12-01 | âœ… Implemented 2025-12-01 |
| 24 | FR-30: Video Transcription (see spec) | 2025-12-02 | âœ… Implemented 2025-12-03 |
| 25 | FR-31: Enhanced Project View with DAM Integration (see spec) | 2025-12-02 | Pending |
| 26 | FR-32: Improved Project List Columns (see below) | 2025-12-03 | âœ… Implemented 2025-12-03 |
| 27 | FR-33: Final Video & SRT Reference (see below) | 2025-12-03 | âœ… Implemented 2025-12-03 |
| 28 | FR-34: Chapter Timestamp Extraction (see spec) | 2025-12-03 | âœ… Phase 2 Done - Phase 3 Pending |
| 29 | FR-35: Fix Chapter Grouping Logic + Total Duration (see below) | 2025-12-03 | âœ… Implemented 2025-12-10 |
| 30 | FR-52: Transcription Progress Bar (see below) | 2025-12-05 | âœ… Implemented 2025-12-05 |
| 31 | FR-53: ASCII Report Formatter (see below) | 2025-12-07 | âœ… Implemented 2025-12-07 |
| 32 | FR-54: Naming Template Bugs (see below) | 2025-12-10 | Pending |
| 33 | FR-55: Video-Level Transcript Export (see below) | 2025-12-12 | âœ… Implemented 2025-12-13 |
| 34 | FR-56: Chapter Navigation Panel (see below) | 2025-12-12 | âœ… Implemented 2025-12-13 |
| 35 | FR-57: Parallelize ffprobe Calls (see below) | 2025-12-13 | âœ… Implemented 2025-12-13 |
| 36 | FR-58: Chapter Recordings (see spec) | 2025-12-13 | âœ… Implemented 2025-12-14, Fixed 2025-12-15 |
| 37 | FR-59: Inbox Tab (see below) | 2025-12-14 | âœ… Implemented 2025-12-14 |
| 38 | FR-60: FliHub Skill Updates (see below) | 2025-12-14 | âœ… Implemented 2025-12-14 |
| 39 | FR-61: Project Resolution Endpoint (see below) | 2025-12-14 | âœ… Implemented 2025-12-14 |
| 40 | FR-62: Rename to FliHub (see below) | 2025-12-14 | âœ… Implemented 2025-12-14 |
| 41 | FR-63: Terminal Quick-Open Button (see below) | 2025-12-14 | âœ… Implemented 2025-12-14 |
| 42 | FR-64: Inbox File Viewer (see below) | 2025-12-14 | âœ… Implemented 2025-12-14 |
| 43 | NFR-65: Extract Shared Server Utilities (see below) | 2025-12-14 | Pending |
| 44 | NFR-66: Consolidate TypeScript Response Types (see below) | 2025-12-14 | Pending |
| 45 | NFR-67: Standardize Server Error Handling (see below) | 2025-12-14 | Pending |
| 46 | NFR-68: Split Query Routes into Sub-Modules (see below) | 2025-12-14 | Pending |
| 47 | FR-69: Header Dropdown Menus (see below) | 2025-12-14 | Pending |
| 48 | FR-71: Watch Page Enhancements (see below) | 2025-12-15 | Pending |
| 49 | FR-72: Fix Chapter Recording Codec Mismatch (see below) | 2025-12-15 | âœ… Implemented 2025-12-15 |
| 50 | FR-73: Template Visibility Rules (see below) | 2025-12-15 | Pending |
| 51 | FR-74: Dual Transcript Output - TXT + SRT (see below) | 2025-12-15 | âœ… Implemented 2025-12-15 |
| 52 | FR-75: Transcript Sync Highlighting - Segments (see below) | 2025-12-15 | âœ… Implemented 2025-12-15 |
| 53 | FR-76: Chapter SRT Generation (see below) | 2025-12-15 | âœ… Implemented 2025-12-15 |
| 54 | FR-77: Transcript Sync Highlighting - Chapters (see below) | 2025-12-15 | âœ… Implemented 2025-12-15 |
| 55 | FR-78: Transcript Stats Require SRT (see below) | 2025-12-15 | âœ… Implemented 2025-12-15 |
| 56 | NFR-79: Tech Debt Exploration (see below) | 2025-12-15 | âœ… Completed 2025-12-15 |
| 57 | FR-80: Enhanced Project List & Stage Model (see below) | 2025-12-15 | Pending |
| 58 | NFR-81: Project List Scanning Optimization (see below) | 2025-12-15 | Future |
| 59 | FR-82: Project List UX Fixes (see below) | 2025-12-15 | âœ… Implemented 2025-12-15 |
| 60 | FR-83: Shadow Recording System (see below) | 2025-12-15 | âœ… Implemented 2025-12-15 |
| 61 | FR-84: Cross-Platform Setup Guide (see below) | 2025-12-15 | âœ… Implemented 2025-12-15 |
| 62 | NFR-85: File Watcher Additions (see below) | 2025-12-15 | âœ… Implemented 2025-12-15 |
| 63 | NFR-86: Git Leak Detection (see below) | 2025-12-15 | Pending |
| 64 | FR-87: GitHub Repo Link in Cog Menu (see below) | 2025-12-15 | âœ… Implemented 2025-12-15 |
| 65 | FR-88: Shadow Fallback in Recordings UI (see below) | 2025-12-15 | Pending |

---

### FR-88: Shadow Fallback in Recordings UI

**Bug:** Shadow-only recordings don't appear in the Recordings list or Watch page.

**Reproduction:**
1. Create recordings in a project (e.g., b88 with 01-1, 01-2, 01-3)
2. Generate shadows (creates 240p .mp4 files in `recording-shadows/`)
3. Delete a real recording (e.g., delete `recordings/01-3-name.mov`)
4. **Expected:** 01-3 still shows with ğŸ‘» indicator (shadow-only)
5. **Actual:** 01-3 disappears from list entirely

**Root cause:** The main `/api/recordings` endpoint in `routes/index.ts` only scans `recordings/` and `-safe/` folders. It doesn't include shadow files.

Note: The Query API (`routes/query/recordings.ts`) already has unified scanning - this pattern should be applied to the main endpoint.

---

#### Requirements

**Recordings list:**
- Shadow-only files appear in the list with `isShadow: true`
- Real files with shadows show `hasShadow: true`
- Visual indicator: ğŸ‘» for shadow-only, ğŸ“¹ğŸ‘» for real+shadow, ğŸ“¹ for real-only

**Watch page:**
- When clicking a shadow-only recording, play the shadow video from `recording-shadows/` folder
- Shadow videos use `.mp4` extension (not `.mov`)

**Files to modify:**
- `server/src/routes/index.ts` - GET /api/recordings endpoint (~line 346)

**Reference implementation:** See `server/src/routes/query/recordings.ts` for unified scanning pattern

---

### FR-87: GitHub Repo Link in Cog Menu

**As a user**, I want a menu item in the cog dropdown that opens the GitHub repository.

---

#### Implementation

Add a new item to the cog menu (top right corner):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Config          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ“‚ Open GitHub  â”‚  â† New item
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Action:** Opens `https://github.com/flivideo/flihub` in new browser tab

**Icon suggestion:** GitHub icon or ğŸ“‚/ğŸ”—

---

### NFR-86: Git Leak Detection

**As a developer**, I want pre-commit hooks that detect secrets and credentials, so I don't accidentally commit sensitive data.

---

#### Investigation Needed

1. **Current state:** Do we have any git hooks set up? Check `.git/hooks/` and any hook management tools.

2. **Options to evaluate:**
   - [gitleaks](https://github.com/gitleaks/gitleaks) - Popular, fast, configurable
   - [detect-secrets](https://github.com/Yelp/detect-secrets) - Yelp's tool
   - [git-secrets](https://github.com/awslabs/git-secrets) - AWS tool
   - [truffleHog](https://github.com/trufflesecurity/trufflehog) - Finds secrets in git history

3. **Integration approach:**
   - Pre-commit hook (block commit if secrets found)
   - Husky for hook management (if not already using)
   - CI/CD integration (GitHub Actions)

4. **What to detect:**
   - API keys (OpenAI, Anthropic, AWS, etc.)
   - Passwords and tokens
   - Private keys
   - Connection strings
   - `.env` file contents

---

#### Deliverable

Report back with:
- Current hook setup (if any)
- Recommended tool
- Implementation steps

---

### NFR-85: File Watcher Additions

**As a user**, I want the UI to auto-refresh when transcripts or thumbnails change, so I don't have to manually refresh to see updates.

---

#### Background

WatcherManager (NFR-6) provides a solid centralized watcher system. However, some folders aren't watched, causing stale UI:

| Folder | Currently Watched | Impact |
|--------|-------------------|--------|
| `recording-transcripts/` | âŒ No | Transcript % doesn't update when transcripts created |
| `assets/thumbs/` | âš ï¸ Partial (ZIP only) | Direct file changes not detected |
| `recordings/-chapters/` | âŒ No | Low priority - UI triggers refresh |
| `-final/` | âŒ No | Low priority |

---

#### Phase 1: Transcripts Watcher (Critical)

**Add:** `startTranscriptsWatcher()` for `recording-transcripts/` folder

**Socket event:** `transcripts:changed`

**Client-side:** Invalidate transcript-related queries on event

**Why critical:** Transcript completion % in ProjectsPanel won't auto-update without this.

---

#### Phase 2: Thumbs Watcher (Convenience)

**Add:** `startThumbsWatcher()` for `assets/thumbs/` folder

**Socket event:** `thumbs:changed` (already defined)

**Why:** Currently only ZIP imports trigger updates. Direct file operations (copy, delete) not detected.

---

#### Phase 3: Ecamm Consolidation (SKIPPED)

Not doing - current separation works fine. Ecamm watcher needs special `awaitWriteFinish` behavior.

---

#### Implementation Pattern

Follow existing WatcherManager pattern:
1. Add `startXxxWatcher()` method
2. Call from `initAll()` and `updateFromConfig()`
3. Emit socket event on change
4. Client subscribes and invalidates queries

---

### FR-83: Shadow Recording System (Video Previews)

**As a collaborator**, I want low-resolution preview videos of recordings, so I can see project content and use transcript features without having the full-size video files.

---

#### Background

FliHub infers project state from the filesystem. Video files (`.mov`, `.mp4`) are large (15-20GB per project) and not committed to git. Collaborators (like Jan on Windows) would see empty projects.

**Shadow videos** solve this by creating ultra low-res (240p) versions that are small enough to share (~1GB per project) while still being watchable and fully functional with transcript features.

---

#### Why Video Shadows (Not Text Placeholders)

| Feature | Text Placeholder | Video Shadow |
|---------|------------------|--------------|
| See file list | âœ… | âœ… |
| See duration/metadata | âœ… | âœ… |
| Watch preview | âŒ | âœ… |
| Transcript sync highlighting | âŒ | âœ… |
| Click-to-seek | âŒ | âœ… |
| Transcribe from shadow | âŒ | âœ… |
| Chapter generation | âŒ | âš ï¸ Low quality but works |

Video shadows give Jan a **fully functional experience** for review and collaboration.

---

#### Part 1: Shadow File Format

**Location:** `recordings-shadow/` directory (sibling to `recordings/`)

**Naming:** Same base name, `.mp4` extension:
```
recordings/01-1-intro.mov              â† Original (18 GB project, gitignored)
recordings-shadow/01-1-intro.mp4       â† Shadow (240p, ~1 GB project, shareable)
```

**FFmpeg settings** (based on chapter recording pattern):
```bash
ffmpeg -i input.mov \
  -vf "scale=-2:240" \
  -c:v libx264 -preset fast -crf 28 \
  -c:a aac -b:a 128k \
  output.mp4
```

**Key choices:**
| Setting | Value | Reason |
|---------|-------|--------|
| Resolution | 240p | Watchable but small (~5-10 MB/min) |
| Video codec | H.264 | Universal compatibility |
| Audio bitrate | 128kbps | Good enough for transcription |
| Container | MP4 | Works everywhere |

---

#### Part 2: Size Estimates

| Resolution | Per Minute | 2-Hour Project | vs Original |
|------------|-----------|----------------|-------------|
| Original (1080p) | ~150 MB | ~18 GB | 100% |
| Shadow (240p) | ~5-10 MB | ~600 MB - 1.2 GB | ~5% |

**Storage approach:** Shadows are `.gitignore`'d like originals. Share via:
- S3 (existing Jan collaboration mechanism)
- Dropbox / external drive
- DAM system (future)

Transcripts (`.txt`, `.srt`) stay in git - they're tiny and valuable.

---

#### Part 3: Unified File Scanning

The system merges files from both directories:

```typescript
function getRecordings(projectPath: string) {
  const realFiles = scan('recordings/')           // .mov, .mp4 (full res)
  const shadowFiles = scan('recordings-shadow/')  // .mp4 (240p)

  // Build unified list, real takes precedence
  const unified = new Map()

  for (const shadow of shadowFiles) {
    const baseName = shadow.replace('.mp4', '')
    unified.set(baseName, { type: 'shadow', file: shadow })
  }

  for (const real of realFiles) {
    const baseName = real.replace(/\.(mov|mp4)$/, '')
    unified.set(baseName, { type: 'real', file: real })
  }

  return unified
}
```

**Result:**
- David (has real files): Sees real files, shadows ignored
- Jan (has shadow files): Sees shadows, full functionality

---

#### Part 4: UI Indicators

**Ghost icon ğŸ‘»** for shadow-only files:

| Context | Real File | Shadow File |
|---------|-----------|-------------|
| Recordings list | ğŸ“¹ Normal | ğŸ‘» Ghost icon |
| Watch page | Full quality | Preview quality (plays normally) |
| Transcript sync | âœ… Works | âœ… Works |
| Transcription | âœ… Full quality | âœ… Works (audio intact) |
| Chapter generation | âœ… Full quality | âš ï¸ Works but low quality output |

**Recordings list example:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chapter 01: Intro                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¹ 01-1-intro.mov              2:34    245 MB       â”‚  â† Real file
â”‚  ğŸ‘» 01-2-hook.mp4               1:45     12 MB       â”‚  â† Shadow (240p)
â”‚  ğŸ“¹ 01-3-overview.mov           3:12    310 MB       â”‚  â† Real file
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Watch page (shadow):**
- Video plays normally (just lower quality)
- Optional: Show "Preview Quality" badge in corner
- Transcript sync highlighting works fully

---

#### Part 5: Generate Shadows (Config Page)

**UI in Config page:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Shadow Videos (Preview Quality)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Generate 240p preview videos for collaborators who don't have   â”‚
â”‚  the original recordings.                                        â”‚
â”‚                                                                  â”‚
â”‚  Current project: 45 recordings, 12 shadows (33 missing)         â”‚
â”‚  Estimated size: ~400 MB for missing shadows                     â”‚
â”‚                                                                  â”‚
â”‚  [Generate Shadows]    [Generate All Projects]                   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  12/33 files  (36%)           â”‚    â”‚
â”‚  â”‚  Currently processing: 01-15-demo-walkthrough.mov       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Process:**
1. Scan `recordings/` for `.mov`/`.mp4` files
2. For each file without a corresponding shadow in `recordings-shadow/`:
   - Transcode to 240p using FFmpeg
   - Show progress bar (like transcription)
3. Report: "Created 33 shadow videos (412 MB)"

**Background processing:** Like transcription, runs in background with progress updates via socket.

---

#### Part 6: Config Page - Watch Directory Status

When `watchDirectory` (Ecamm Live) doesn't exist or isn't configured:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Watch Directory (Ecamm Live)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸ”´ Not configured                                               â”‚
â”‚  Incoming recordings from Ecamm Live will not be detected.       â”‚
â”‚                                                                  â”‚
â”‚  Path: [______________________________________] [Browse]         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Status indicators:**
| State | Display |
|-------|---------|
| Configured + exists | ğŸŸ¢ Watching: `/path/to/ecamm/` |
| Configured + missing | ğŸŸ¡ Path not found: `/path/to/ecamm/` |
| Not configured | ğŸ”´ Not configured - Ecamm files will not be detected |

---

#### Part 7: Safe Directory Shadows

Apply same pattern to `recordings/-safe/`:

```
recordings/-safe/01-1-intro.mov              â† Real safe file
recordings-shadow/-safe/01-1-intro.mp4       â† Shadow safe file
```

---

#### Files to Modify/Create

| File | Changes |
|------|---------|
| `server/src/utils/scanning.ts` | Unified scanning (real + shadow) |
| `server/src/utils/shadowVideos.ts` | New - FFmpeg transcoding logic |
| `server/src/routes/shadows.ts` | New - API endpoints |
| `client/src/components/ConfigPanel.tsx` | Shadow generation UI, watch dir status |
| `client/src/components/RecordingsView.tsx` | Ghost icon ğŸ‘» for shadows |
| `client/src/components/WatchPage.tsx` | Optional "Preview Quality" badge |
| `shared/types.ts` | Add `isShadow: boolean` to recording types |

---

#### API Endpoints

```
POST /api/shadows/generate
  Body: { projectCode?: string }  // Optional, defaults to current project
  Response: { queued: number, skipped: number }

POST /api/shadows/generate-all
  Response: { projects: number, queued: number, skipped: number }

GET /api/shadows/status
  Response: {
    currentProject: { recordings: number, shadows: number, missing: number },
    watchDirectory: { configured: boolean, exists: boolean, path: string },
    queue: { processing: string | null, remaining: number, progress: number }
  }
```

**Socket events:**
- `shadows:progress` - `{ file: string, percent: number }`
- `shadows:complete` - `{ file: string, size: number }`
- `shadows:error` - `{ file: string, error: string }`

---

### FR-84: Cross-Platform Setup Guide

**As a Windows user**, I want clear documentation to set up and run FliHub, understanding that my use case differs from the Mac-based creator workflow.

**Status:** Blocked by FR-83 (needs shadow system to be useful)

**Scope:** Documentation only (not code changes)

---

#### Target Audience

- **Primary:** Jan (video editor, Windows)
- **Secondary:** Future collaborators on any platform

---

#### Document Sections

1. **Prerequisites**
   - Node.js v18+ installation
   - Git setup
   - FFmpeg installation (Windows)
   - WhisperAI setup (optional, for transcription)

2. **Installation**
   - Clone repo
   - `npm install`
   - Initial config setup

3. **Configuration for Recipients**
   - What to set when you're NOT recording videos
   - Watch directory: leave blank or set to dummy path
   - Project directory setup

4. **Understanding Shadow Files**
   - What they are
   - Why some features are disabled
   - How to recognize shadow-only content (ğŸ‘»)

5. **What Works Without Video Files**
   - Project list âœ…
   - Transcripts (if txt/srt exist) âœ…
   - Assets/images âœ…
   - Inbox âœ…
   - Video playback âŒ
   - Transcription âŒ
   - Chapter generation âŒ

6. **Alternative Screen Recorders** (Future Reference)
   - OBS Studio
   - Camtasia
   - ScreenFlow (Mac)
   - Generic folder watch mode

---

#### Document Location

`/docs/setup-guide-windows.md` or `/docs/cross-platform-setup.md`

---

### FR-82: Project List UX Fixes

**As a user**, I want the project list indicators to be clear and informative, and I want the transcript percentage to show accurate values.

---

#### Part 1: Transcript Percentage Bug (0% everywhere)

**Problem:** All projects show 0% for transcripts, which is incorrect.

**Investigation needed:** Check `getTranscriptSyncStatus()` in `server/src/utils/scanning.ts` - FR-78 was supposed to fix this by requiring both `.txt` and `.srt` files, but something isn't working.

**Expected:** Projects with transcripts should show accurate percentages (e.g., 80%, 100%).

---

#### Part 2: Indicator Icon Tooltips

**Problem:** The three indicator icons (ğŸ“¥ğŸ–¼ğŸ¬) use basic `title` attributes. The green tick (âœ…) has rich hover tooltips with detailed info - the indicators should match.

**Current:**
- Native browser tooltip: "Has inbox files - click to view"
- No counts or details

**Required:** Match the `FinalMediaCell` pattern (lines 75-119 in `ProjectsPanel.tsx`):

| Icon | Hover Tooltip Content |
|------|----------------------|
| ğŸ“¥ Inbox | "Inbox: 5 files" or "Inbox: empty" |
| ğŸ–¼ Assets | "Assets: 8 images, 3 prompts" or "Assets: empty" |
| ğŸ¬ Chapters | "Chapters: 4 videos" or "Chapters: empty" |

**Implementation:** Create `IndicatorCell` component similar to `FinalMediaCell`:
- State for `showTooltip`
- `onMouseEnter`/`onMouseLeave` handlers
- Absolute positioned tooltip div

---

#### Part 3: Blank Empty Indicators

**Problem:** Empty indicators show faded icons (`opacity-30`), which still look like icons and create visual noise.

**Required:** When empty, show nothing (blank space). Maintain column padding so layout doesn't shift.

```
Has content:  ğŸ“¥ ğŸ–¼ ğŸ¬
Mixed:        ğŸ“¥    ğŸ¬    â† middle is blank, not faded
Empty:                    â† all blank
```

**Implementation:** Change from `opacity-30` to not rendering the icon at all, but keep the button wrapper for consistent spacing.

---

#### Files to Modify

| File | Changes |
|------|---------|
| `server/src/utils/scanning.ts` | Investigate/fix `getTranscriptSyncStatus()` |
| `client/src/components/ProjectsPanel.tsx` | Add rich tooltips, blank empty indicators |

---

#### API Changes

The server may need to return counts for the tooltips:

```typescript
interface ProjectStats {
  // Existing
  hasInbox: boolean
  hasAssets: boolean
  hasChapters: boolean

  // New (for tooltips)
  inboxCount?: number
  assetImageCount?: number
  assetPromptCount?: number
  chapterVideoCount?: number
}
```

Or the client can derive counts from existing data if available.

---

### FR-80: Enhanced Project List & Stage Model

**As a user**, I want to see at-a-glance which projects have inbox files, assets, and chapter videos, and I want stage values that reflect my actual video production workflow.

---

#### Part 1: Project List Indicators

Add three clickable icon indicators to each project row:

| Indicator | Shows | Click Action |
|-----------|-------|--------------|
| ğŸ“¥ Inbox | Has files in `inbox/` | Navigate to Inbox tab |
| ğŸ–¼ Assets | Has files in `assets/images/` or `assets/prompts/` | Navigate to Assets tab |
| ğŸ¬ Chapters | Has files in `recordings/-chapters/` | Navigate to Chapters tab |

Icons should be visually distinct (filled vs outline, or colored vs grey) to show presence/absence.

---

#### Part 2: Stage Model

Replace current `record`, `edit`, `done` with workflow-aligned stages:

| Stage | When | Trigger |
|-------|------|---------|
| `planning` | Project created | Auto (default for new projects) |
| `recording` | First recording added | Auto |
| `first-edit` | Done recording, doing Gling cuts | Manual |
| `second-edit` | Sent to Jan for graphics/overlays | Manual (may trigger S3 upload in future) |
| `review` | Jan done, user reviewing | Manual |
| `ready-to-publish` | Signed off, needs publishing | Manual |
| `published` | On YouTube | Manual |
| `archived` | On NAS, completely done | Manual (future DAM integration) |

**Auto-triggers:**
- `planning` â†’ `recording`: When first recording file appears in project
- All others: Manual stage change by user

**Configuration:**
Stages should be configurable (comma-delimited in config or env) so we can adjust over time without code changes.

```json
// server/config.json
{
  "projectStages": [
    "planning",
    "recording",
    "first-edit",
    "second-edit",
    "review",
    "ready-to-publish",
    "published",
    "archived"
  ]
}
```

---

#### Part 3: Stage UI

Keep click-to-cycle for quick stage changes. With 8 stages, cycling is still reasonable.

Alternative: dropdown on hover/click if cycling becomes tedious.

---

#### Migration

Map existing values:
- `record` â†’ `recording`
- `edit` â†’ `first-edit`
- `done` â†’ `published`

Or prompt user to re-select for affected projects.

---

#### Files to Modify

| File | Changes |
|------|---------|
| `server/src/utils/scanning.ts` | Add inbox/assets/chapters detection to project scan |
| `shared/types.ts` | Update ProjectStage type |
| `client/src/components/ProjectsPanel.tsx` | Add indicators with click navigation, update stage display |
| `server/config.json` | Add `projectStages` array, migrate existing values |

---

#### Acceptance Criteria

- [ ] Project list shows inbox/assets/chapters indicators
- [ ] Clicking indicator navigates to appropriate tab
- [ ] Stage values configurable via config
- [ ] New projects default to `planning`
- [ ] Auto-transition to `recording` when first recording added
- [ ] Existing projects migrated to new stage values
- [ ] Stage click-to-cycle works with new stages

---

### NFR-79: Tech Debt Exploration

**As a product owner**, I want a developer audit of known and potential tech debt areas, so we can prioritize cleanup work effectively.

---

#### Purpose

This is a **research task**. Developer investigates, documents findings, and hands back to PO. PO then creates/updates FRs based on findings.

---

#### Areas to Investigate

**1. In-Memory Transcription Queue**

Location: `server/src/routes/transcriptions.ts:12-16`

Known issue: Global mutable state for transcription queue. Lost on server restart.

Questions to answer:
- How significant is this in practice?
- What happens if server restarts mid-transcription?
- Is there a simple fix (persist to file)? Or is this fine as-is?
- Recommendation: Fix, defer, or accept?

---

**2. AssetsPage.tsx Quick Wins**

Location: `client/src/components/AssetsPage.tsx`

Known issue: 1355 lines, 20+ state variables. Complex but functional.

**NOT in scope:** UX redesign (that's separate, PO not ready)

**In scope:** Code-level quick wins that don't change behavior:
- Can any logic be extracted to custom hooks?
- Are there obvious component extractions that don't require UX decisions?
- Any dead code or unused state?
- Any performance issues (unnecessary re-renders)?

Questions to answer:
- List 3-5 quick wins that could be done safely
- Estimate effort for each (small/medium)
- Any that are risky without tests?

---

**3. General Code Health Scan**

While investigating the above, note any other tech debt observed:
- Large files that could be split
- Duplicated logic across files
- Inconsistent patterns
- Missing error handling
- Anything that made you go "hmm"

---

#### Output Expected

A handover document with:

```
## Tech Debt Findings

### 1. Transcription Queue
- Current state: [description]
- Risk level: [low/medium/high]
- Recommendation: [fix/defer/accept]
- If fix: [proposed approach, effort estimate]

### 2. AssetsPage Quick Wins
- Quick win 1: [description, effort, risk]
- Quick win 2: [description, effort, risk]
- ...

### 3. Other Observations
- [anything else noticed]

### Recommendations
- [prioritized list of what to tackle]
```

---

#### What Happens Next

PO receives findings and:
1. Creates new FRs for items worth fixing
2. Updates existing NFRs if they overlap (e.g., NFR-65/66/67)
3. Deprecates any FRs that are no longer relevant
4. Parks items that aren't worth the effort

---

#### Files to Review

| File | Why |
|------|-----|
| `server/src/routes/transcriptions.ts` | Transcription queue state |
| `client/src/components/AssetsPage.tsx` | Large complex component |
| Any others that catch your eye | General health |

---

#### Acceptance Criteria

- [x] Transcription queue investigated, recommendation provided
- [x] 3-5 AssetsPage quick wins identified (code-level, not UX)
- [x] Any other tech debt observations documented
- [x] Findings handed back to PO in structured format

---

#### Findings (2025-12-15)

**1. Transcription Queue**

| Aspect | Finding |
|--------|---------|
| Current state | Global mutable state: `queue`, `activeJob`, `recentJobs`, `activeProcess` in `transcriptions.ts:12-16` |
| Risk level | **Low** |
| What happens on restart | Queue and active job are lost. BUT: system checks for existing transcripts before processing, duplicates are skipped, no data corruption possible |
| Recommendation | **Accept** - Current design is safe. Transcripts are saved to disk, duplicate detection prevents re-processing, user can re-queue on restart |

Optional improvement (if desired): Persist queue to `server/.transcription-queue.json`. Effort: ~30 mins. Not necessary for current use case.

---

**2. AssetsPage Quick Wins**

Actual state: 8 `useState` calls, 6 `useMemo` calls (not 20+ as originally noted).

| Quick Win | Description | Effort | Risk |
|-----------|-------------|--------|------|
| 1. ~~Extract `toKebabCase`~~ | ~~Duplicated in AssetsPage + RenameLabelModal~~ | ~~Small~~ | ~~Low~~ |
| 2. Extract `useChapterNavigation` hook | Lines 226-290: goToPrev/NextChapter, goToPrev/NextSequence + chapterMap logic (~70 lines) | Small | Low |
| 3. Extract `usePersistedState` hook | Lines 105-138: localStorage persistence pattern (also used for size toggles) | Small | Low |
| 4. Extract windowed recordings logic | Lines 293-326: windowedRecordings useMemo. Could be `useWindowedRecordings()` | Small | Low |
| 5. Extract `PairedAsset` grouping | Lines 1033-1087: IIFE that builds pairedAssets Map | Medium | Low |

**Quick Win #1 completed:** `toKebabCase` extracted to `client/src/utils/formatting.ts` (commit 2ce9743).

**Not recommended:** Component splitting would require UX decisions.

**Dead code:** None found.

**Performance:** All expensive computations properly memoized.

---

**3. Other Observations**

| Observation | Details |
|-------------|---------|
| Large files | `routes/index.ts` (857 lines), `routes/assets.ts` (798 lines) - could split by domain but not urgent |
| Duplicated pattern | `getProjectPaths(expandPath(config.projectDirectory))` appears 23 times - could extract helper |
| Error responses | 60+ `res.status(500).json()` with varying formats - already tracked in NFR-67 |
| Similar in-memory pattern | `routes/index.ts:28-30` has `recentRenames[]` - same low-risk pattern as transcription queue |

---

**4. Prioritized Recommendations**

| Priority | Item | Notes |
|----------|------|-------|
| ~~1~~ | ~~Extract `toKebabCase`~~ | âœ… Done |
| 2 | Extract `useChapterNavigation` hook | Removes ~70 lines from AssetsPage |
| 3 | Extract `usePersistedState` hook | Reusable pattern |
| 4 | Complete NFR-67 (error handling) | Already in backlog |
| 5 | Consider project path helper | Low priority, reduces boilerplate |

---

### NFR-81: Project List Scanning Optimization

**Status:** Future

**As a developer**, I want an efficient way to populate project list indicators without scanning directories on every load.

---

#### Context

FR-80 adds inbox/assets/chapters indicators to the project list. Currently, the project list scans directories for each project to gather stats. Adding three more directory checks per project could slow things down with many projects.

---

#### Options to Consider

**Option A: Live Scan (Current Pattern)**
```
User opens Projects page
â†’ For each project, server scans:
   - Does /inbox have files?
   - Does /assets/images have files?
   - Does /-chapters have videos?
â†’ Returns indicators
```
- **Pro:** Always accurate
- **Con:** Slower with 30+ projects (many directory reads)

**Option B: Cached Metadata**
```
project.json stores:
{
  "hasInbox": true,
  "hasAssets": false,
  "hasChapters": true
}
```
Server updates these when files change (via watchers).
- **Pro:** Instant project list load
- **Con:** Could get stale if watchers miss something

**Option C: Hybrid**
- Live scan on first load, cache results for session
- Watchers update cache in real-time
- Background refresh periodically

---

#### When to Implement

Not needed for FR-80 initial implementation. Start with live scan (Option A).

Revisit if:
- Project list becomes noticeably slow
- User has 30+ active projects
- Scanning latency exceeds 500ms

---

#### Notes

This is a performance optimization, not a feature. Only implement when there's a measurable problem.

---

### FR-78: Transcript Stats Require SRT

**As a user**, I want project transcript stats to reflect whether SRT files exist, so I have an accurate picture of transcript completeness.

---

#### Context

FR-74 changed the transcription system to require both `.txt` AND `.srt` for a transcript to be "complete". However, `getTranscriptSyncStatus()` still only checks for `.txt` files, creating an inconsistency.

#### Change

Update `getTranscriptSyncStatus()` in `server/src/utils/scanning.ts` to require both files for "matched" status.

**Current (line 77-79):**
```typescript
const transcriptFiles = transcriptDirFiles
  .filter(f => f.endsWith('.txt') && !f.endsWith('-chapter.txt'))
```

**New:**
```typescript
// A transcript is "matched" only if both .txt and .srt exist
const txtFiles = transcriptDirFiles.filter(f => f.endsWith('.txt') && !f.endsWith('-chapter.txt'));
const srtFiles = transcriptDirFiles.filter(f => f.endsWith('.srt'));
// Match logic: recording has BOTH .txt and .srt
```

#### UX Impact

- Existing projects with txt-only transcripts will show lower completion %
- Projects may temporarily flip from "editing" â†’ "recording" stage until re-transcribed
- This is intentional: communicates that action is needed for sync features

#### Files to Modify

| File | Changes |
|------|---------|
| `server/src/utils/scanning.ts` | Update getTranscriptSyncStatus() to check for both files |

#### Acceptance Criteria

- [ ] "Matched" count only includes recordings with BOTH .txt and .srt
- [ ] "Missing" includes recordings with txt-only (needs re-transcription)
- [ ] Consistent with FR-74's definition of complete

---

### FR-74: Dual Transcript Output (TXT + SRT)

**As a user**, I want transcription to generate both TXT and SRT files, so I have timing data available for sync features.

---

#### Current State

Transcription generates only `.txt` files (plain text, no timing).

#### Change

Configure whisper to output **both** formats during transcription.

#### Output

```
recording-transcripts/
â”œâ”€â”€ 01-1-intro.txt      # Plain text (existing)
â”œâ”€â”€ 01-1-intro.srt      # Timed subtitles (NEW)
â”œâ”€â”€ 02-1-demo.txt
â”œâ”€â”€ 02-1-demo.srt
```

#### SRT Format

Standard SRT with sequential entries:

```
1
00:00:00,000 --> 00:00:03,500
So today we're going to look at

2
00:00:03,500 --> 00:00:06,200
the BMAD method and how it can

3
00:00:06,200 --> 00:00:09,100
help you build better AI workflows.
```

**Note:** Each segment's SRT is zero-based (starts at 00:00:00).

#### Files to Modify

| File | Changes |
|------|---------|
| `server/src/routes/transcriptions.ts` | Add SRT output to whisper call |

#### Acceptance Criteria

- [ ] Transcription generates both `.txt` and `.srt` files
- [ ] SRT follows standard format with timing
- [ ] Existing TXT behavior unchanged

---

### FR-75: Transcript Sync Highlighting (Segments)

**As a user**, I want words highlighted in the transcript as the video plays, so I can follow along and identify specific moments.

**Depends on:** FR-74

---

#### Concept

On the Watch page, display transcript panel below/beside video. As video plays, highlight the current word or phrase based on SRT timing.

#### UI Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [VIDEO PLAYER]                                                  â”‚
â”‚  â”â”â”â”â”â”â”â”â”â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 0:15 / 1:30                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  So today we're going to look at the â–ˆâ–ˆâ–ˆBMAD methodâ–ˆâ–ˆâ–ˆ and how  â”‚
â”‚  it can help you build better AI workflows. Let's start with    â”‚
â”‚  the core concepts and then move into practical examples...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Highlighting Modes

Toggle between granularity levels:

| Mode | Behavior |
|------|----------|
| **Word** (default) | Individual words highlight as spoken |
| **Phrase** | Entire SRT entry (typically 2-4 seconds) highlights |

Toggle button in UI: `[Word â†” Phrase]`

#### How It Works

1. Load segment's `.srt` file when video selected
2. Parse into array of `{ start, end, text }` entries
3. Listen to video `timeupdate` event
4. Find entry where `start <= currentTime < end`
5. Highlight matching text in transcript panel

**For word-level:** Parse each SRT entry into individual words, distribute timing evenly across words in the phrase.

#### Files to Modify

| File | Changes |
|------|---------|
| `client/src/components/WatchPage.tsx` | Add transcript panel, SRT parsing, highlighting logic |
| `client/src/hooks/useApi.ts` | Hook to fetch SRT content |
| `server/src/routes/query.ts` | Endpoint to serve SRT file content |

#### Acceptance Criteria

- [ ] Transcript panel displays below video on Watch page
- [ ] Words/phrases highlight as video plays
- [ ] Toggle between Word and Phrase mode
- [ ] Clicking a word in transcript seeks video to that time
- [ ] Preference persists in localStorage

---

### FR-76: Chapter SRT Generation

**As a user**, I want chapter videos to have corresponding SRT files with correct timing, so transcript sync works for combined chapters.

**Depends on:** FR-74

---

#### Context

Chapter videos concatenate multiple segments. Each segment has its own zero-based SRT. The chapter SRT must offset each segment's timing by cumulative duration.

#### Purple Slides Toggle

**Change to FR-58:** Make purple title slides **optional** (toggle, off by default).

| Setting | Behavior |
|---------|----------|
| Slides OFF (default) | Chapter video is pure concatenation of segments |
| Slides ON | Purple title slides between segments (current behavior) |

**Why:** Slides complicate timing calculation and may not be needed once transcript highlighting shows chapter transitions visually.

**Config addition:**
```json
{
  "chapterRecordings": {
    "includeTitleSlides": false,  // NEW - default false
    "slideDuration": 1.0,
    "resolution": "720p"
  }
}
```

#### SRT Generation

When generating chapter video, also generate `{chapter}-{label}.srt`:

**Without slides (simple):**
```
Segment 1 SRT times + 0
Segment 2 SRT times + segment1.duration
Segment 3 SRT times + segment1.duration + segment2.duration
...
```

**With slides (if enabled):**
```
Segment 1 SRT times + slideDuration
Segment 2 SRT times + slideDuration + segment1.duration + slideDuration
...
```

#### Output

```
recordings/-chapters/
â”œâ”€â”€ 01-intro.mov
â”œâ”€â”€ 01-intro.srt       # NEW
â”œâ”€â”€ 03-scenario.mov
â”œâ”€â”€ 03-scenario.srt    # NEW
```

#### Files to Modify

| File | Changes |
|------|---------|
| `server/src/utils/chapterRecording.ts` | Add SRT generation, slides toggle |
| `server/config.json` | Add `includeTitleSlides` option |

#### Acceptance Criteria

- [ ] Chapter video generation also produces `.srt` file
- [ ] SRT timing correctly offset for concatenated segments
- [ ] Purple slides toggleable (off by default)
- [ ] With slides ON, timing accounts for slide durations

---

### FR-77: Transcript Sync Highlighting (Chapters)

**As a user**, I want transcript highlighting to work when watching chapter videos, using the chapter's combined SRT.

**Depends on:** FR-75, FR-76

---

#### Behavior

Extends FR-75 to detect when playing a chapter video and use the chapter SRT instead of segment SRT.

#### Detection Logic

| Video Source | SRT Source |
|--------------|------------|
| `recordings/01-1-intro.mov` | `recording-transcripts/01-1-intro.srt` |
| `recordings/-chapters/01-intro.mov` | `recordings/-chapters/01-intro.srt` |

#### UI Enhancement

When playing chapter video, transcript panel could show chapter markers:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”€â”€ Segment 1: intro â”€â”€                                         â”‚
â”‚  So today we're going to look at the â–ˆâ–ˆâ–ˆBMAD methodâ–ˆâ–ˆâ–ˆ...       â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€ Segment 2: intro â”€â”€                                         â”‚
â”‚  Now let's dive deeper into the core concepts...                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Files to Modify

| File | Changes |
|------|---------|
| `client/src/components/WatchPage.tsx` | Detect chapter video, load chapter SRT |

#### Acceptance Criteria

- [ ] Highlighting works for chapter videos
- [ ] Uses chapter SRT with correct offsets
- [ ] Segment boundaries visible in transcript panel (optional)

---

### FR-73: Template Visibility Rules

**As a user**, I want quick-select templates to be filtered based on the current chapter, so I only see relevant options and reduce cognitive load.

---

#### Problem

The quick-select template buttons (intro, demo, summary, outro) always show all options regardless of recording context. Some templates like "intro" are only relevant in early chapters (01-04), yet they appear throughout the entire recording session.

**Current behavior:** All templates visible all the time
**Desired behavior:** Templates filtered by chapter number

---

#### Solution

Add `showInChapters` property to each template in the config. The UI filters templates based on the current chapter being recorded.

**Updated config schema:**

```json
{
  "commonNames": [
    {
      "name": "intro",
      "autoSequence": true,
      "showInChapters": [1, 2, 3, 4]
    },
    {
      "name": "scenario",
      "showInChapters": [1, 2, 3, 4]
    },
    {
      "name": "demo",
      "showInChapters": "all"
    },
    {
      "name": "summary",
      "showInChapters": "all"
    },
    {
      "name": "outro",
      "suggestTags": ["RECAP", "ENDCARD"],
      "showInChapters": "all"
    }
  ]
}
```

**Rules:**
- `showInChapters: [1, 2, 3, 4]` â€” Only show in chapters 1-4
- `showInChapters: "all"` â€” Show in all chapters (default if omitted)
- Numbers are chapter integers (1 = "01", 10 = "10")

---

#### Also Include

Add missing **"scenario"** template â€” a common early-chapter recording type that's currently not available.

---

#### UI Behavior

On the Incoming tab:
1. Determine current chapter from the chapter selector or most recent recording
2. Filter `commonNames` to only show templates where current chapter matches `showInChapters`
3. Templates with `showInChapters: "all"` or no `showInChapters` always appear

**Example:**
- Chapter 01 selected â†’ Show: intro, scenario, demo, summary, outro (5 buttons)
- Chapter 10 selected â†’ Show: demo, summary, outro (3 buttons)

---

#### Files to Modify

| File | Changes |
|------|---------|
| `server/config.json` | Add `showInChapters` to templates, add "scenario" |
| `shared/types.ts` | Update CommonName interface |
| `client/src/components/IncomingPage.tsx` | Filter templates by chapter |
| `client/src/components/ConfigPage.tsx` | (Optional) UI to edit visibility rules |

---

#### Acceptance Criteria

- [ ] Templates filtered based on current chapter
- [ ] "scenario" template added for early chapters
- [ ] Templates without `showInChapters` default to showing in all chapters
- [ ] Config page shows/edits visibility rules (optional, can defer)

---

### FR-72: Fix Chapter Recording Codec Mismatch

**As a user**, I want chapter recordings to play correctly without audio pitch changes or video freezing, so I can review combined chapters reliably.

---

#### The Bug

FR-58 (Chapter Recordings) produces corrupted output:
- **Voice pitch changes** - audio sounds wrong
- **Video freezes** after a few seconds
- Essentially unwatchable output

#### Root Cause

The current implementation uses FFmpeg's **concat demuxer** (`-f concat`) which requires all input files to have identical stream parameters.

**The mismatch:**

| Parameter | Title Slides (generated) | Ecamm Recordings |
|-----------|--------------------------|------------------|
| Video codec | H.264 (libx264) | ProRes (likely) |
| Frame rate | FFmpeg default (~25fps) | Ecamm setting (30/60fps) |
| Audio codec | AAC | PCM or AAC |
| Sample rate | FFmpeg default (44.1kHz?) | 48kHz (video standard) |
| Pixel format | yuv420p (H.264 default) | yuv422p10le (ProRes) |

When concat demuxer encounters mismatched streams, it produces the exact symptoms described.

---

#### The Fix: Use Concat Filter

Replace the concat **demuxer** with the concat **filter**. The filter properly re-encodes all inputs through a unified pipeline, handling codec/framerate/samplerate differences automatically.

**Current approach** (`chapterRecording.ts:166-183`):
```bash
# Concat demuxer - requires identical streams
ffmpeg -f concat -safe 0 -i concat.txt -vf scale=... -c:v libx264 output.mov
```

**Fixed approach:**
```bash
# Concat filter - handles different inputs properly
ffmpeg \
  -i slide1.mov -i segment1.mov -i slide2.mov -i segment2.mov \
  -filter_complex "[0:v][0:a][1:v][1:a][2:v][2:a][3:v][3:a]concat=n=4:v=1:a=1[v][a]" \
  -map "[v]" -map "[a]" \
  -vf "scale=1280:720" \
  -c:v libx264 -preset fast \
  -c:a aac \
  output.mov
```

---

#### Implementation Notes

1. **Dynamic input count** - The filter_complex string needs to be built dynamically based on number of segments
2. **Input ordering** - Alternate: slide, segment, slide, segment...
3. **Stream mapping** - Each input contributes `[N:v][N:a]` to the concat filter
4. **Keep existing code** - Title slide generation, file naming, progress events all stay the same

**Example for 3 segments:**
```bash
ffmpeg \
  -i slide1.mov -i seg1.mov \
  -i slide2.mov -i seg2.mov \
  -i slide3.mov -i seg3.mov \
  -filter_complex "[0:v][0:a][1:v][1:a][2:v][2:a][3:v][3:a][4:v][4:a][5:v][5:a]concat=n=6:v=1:a=1[v][a]" \
  -map "[v]" -map "[a]" \
  -c:v libx264 -preset fast -c:a aac \
  output.mov
```

---

#### Files to Modify

| File | Changes |
|------|---------|
| `server/src/utils/chapterRecording.ts` | Replace `concatenateVideos()` function |

---

#### Acceptance Criteria

- [ ] Chapter recordings play without audio pitch changes
- [ ] Video doesn't freeze or corrupt
- [ ] All existing functionality preserved (title slides, timestamps, beep sounds)
- [ ] Works with Ecamm Live ProRes recordings

---

### FR-69: Header Dropdown Menus

**As a user**, I want the header icons organized into dropdown menus, so the interface is cleaner and related actions are grouped together.

---

#### Current State

The header currently has several standalone elements:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FliHub â€º b86-claudemas-01-jump â–¼  [ğŸ“‹] [>_]                            [âš™]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†‘    â†‘                               â†‘
                                 Calendar  Terminal                    Config
                                   copy    path copy                    page
```

**Issues:**
- Multiple small buttons cluttering the header
- Config and Mockups are tabs, but Config also has a gear icon
- Clipboard buttons don't indicate what they copy
- No room for future header actions

---

#### Proposed Changes

**1. Gear Menu (Settings/Tools)**

Convert the gear icon from a direct link to a dropdown menu:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Configuration         âš™  â”‚
â”‚  Mockups               ğŸ¨  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  API Help              ğŸ’¡  â”‚  â† Future: Claude Code tips panel
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Click gear â†’ dropdown appears
- Config and Mockups move here (removed from main nav)
- Future: API Help could trigger the tips panel (from brainstorming)

---

**2. Project Actions Menu**

Group the project-related clipboard buttons:

```
Current:  b86-claudemas-01-jump â–¼  [ğŸ“‹] [>_]

Proposed: b86-claudemas-01-jump â–¼  [Â·Â·Â·]
                                     â†“
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚  Copy for calendar  ğŸ“‹ â”‚
                           â”‚  Copy full path     >_ â”‚
                           â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
                           â”‚  Open in Finder     ğŸ“‚ â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Single `[Â·Â·Â·]` or `[â–¾]` button replaces multiple icons
- Dropdown shows available project actions with labels
- Room to add more project-specific actions later

---

#### UI Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FliHub â€º b86-claudemas-01-jump â–¼ [Â·Â·Â·]                                 [âš™]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Incoming] [Recordings] [Transcripts] [Inbox] [Assets] [Thumbs] [Projects]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Nav changes:**
- Config removed from nav (moved to gear menu)
- Mockups removed from nav (moved to gear menu, or removed after design finalized)

---

#### Implementation Notes

| Component | Change |
|-----------|--------|
| `App.tsx` | Replace gear button with dropdown trigger |
| `App.tsx` | Replace clipboard buttons with single dropdown trigger |
| New component | `HeaderDropdown.tsx` - reusable dropdown component |
| Nav bar | Remove Config tab, optionally remove Mockups |

---

#### Acceptance Criteria

- [ ] Gear icon opens dropdown menu with Config and Mockups options
- [ ] Project name area has single dropdown trigger for clipboard actions
- [ ] Each dropdown item has icon and descriptive label
- [ ] Dropdowns close when clicking outside
- [ ] Config and Mockups removed from main navigation tabs
- [ ] Existing functionality preserved (copy calendar, copy path, open config)

---

### FR-71: Watch Page Enhancements

**As a user**, I want the Watch page to auto-select the most recent recording, default to 2x playback speed, and have a larger video player, so I can quickly review my recordings at speed.

---

#### Context

The Watch page (FR-70) was recently implemented with a cascading chapter/segment panel. This FR enhances the playback experience based on real usage feedback.

**Current state:**
- Video player shows "Select a recording to play" on page load
- Native browser controls (max 2x visible, though up to 16x is supported)
- Video container is constrained by the page's central container width

---

#### Requirements

| # | Requirement | Priority |
|---|-------------|----------|
| 1 | Auto-select last recording on page load | High |
| 2 | Default playback speed to 2x | High |
| 3 | Custom speed control with presets | Medium |
| 4 | Video size toggle (Normal / Large / Extra Large) | Medium |
| 5 | Transcript panel below video | High |
| 6 | Persist preferences in localStorage | Low |

---

#### 1. Auto-Select Last Recording

**Behavior:**
- On page load, automatically select and load the most recent named recording
- "Most recent" = highest chapter number, then highest sequence number
- Example: If recordings are `01-1-intro`, `01-2-intro`, `10-1-demo`, select `10-1-demo`
- Do NOT auto-play - just pre-load so user can hit play

**Why last recording:**
- After a recording session, user often wants to review what they just captured
- Eliminates the "Select a recording" empty state on fresh load
- Chapter panel still shows full structure for navigation

---

#### 2. Default to 2x Playback Speed

**Behavior:**
- When a video loads, set `playbackRate = 2.0`
- Apply to all videos (segments and chapter recordings)

**Technical note:**
- HTML5 video supports 0.07x to 16x
- Audio is muted by browser outside ~0.25x to 4x range
- 2x is a good default - fast review with audio intact

---

#### 3. Custom Speed Control

**UI:** Speed selector below or overlaying the video player

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚                    VIDEO PLAYER                         â”‚
â”‚                                                         â”‚
â”‚   [â–¶] â”â”â”â”â”â”â”â”â”â—â”â”â”â”â”â”â”â”â”â”â” 2:15 / 5:30                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Speed: [1x] [1.5x] [2xâ—] [2.5x] [3x] [4x]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Presets:**

| Speed | Audio | Use Case |
|-------|-------|----------|
| 1x | âœ“ | Normal playback |
| 1.5x | âœ“ | Slightly faster review |
| 2x | âœ“ | Quick review (default) |
| 2.5x | âœ“ | Fast review |
| 3x | âœ“ | Rapid scan |
| 4x | âœ“ (edge) | Maximum with audio |

**Optional "turbo" speeds** (audio muted):
- 6x, 8x, 10x - for visual-only scanning
- Show muted indicator when speed > 4x

---

#### 4. Video Size Toggle

**Concept:** Offer 3 size options instead of just making the video bigger. Default to Normal since the transcript panel needs screen space too.

| Size | Description | Use Case |
|------|-------------|----------|
| **Normal** | Current size (default) | Balanced view with transcript panel |
| **Large** | Wider video | Focus on video, less transcript |
| **Extra Large** | Maximum width | Immersive viewing, minimal UI |

**UI:** Size toggle near the speed controls

```
Speed: [1x] [1.5x] [2xâ—] [2.5x] [3x] [4x]     Size: [Nâ—] [L] [XL]
```

**Visual comparison:**

```
Normal:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚            VIDEO                   â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚         TRANSCRIPT PANEL           â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Large:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚     â”‚                         VIDEO                                â”‚         â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚     â”‚                    TRANSCRIPT PANEL                          â”‚         â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Extra Large:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                              VIDEO                                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                         TRANSCRIPT PANEL                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**UX rationale:**
- Start at Normal because transcript panel is valuable for review
- User can expand if they want more immersive video
- Both video AND transcript scale together

**Consideration:** Chapter panel slides in from right - at Extra Large, may need to shrink video slightly when panel is visible.

---

#### 5. Transcript Panel Below Video

**Concept:** A well-designed, readable transcript panel positioned below the video player. Must handle both segment and chapter recordings.

**Panel design:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Transcript                                               [Collapse â–¼]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  So this is where we're going to start building out the application.        â”‚
â”‚  The first thing we need to do is set up the project structure.             â”‚
â”‚  And you can see here that we have the main components folder...            â”‚
â”‚                                                                              â”‚
â”‚  [continuing transcript text in readable, well-spaced format]               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Design requirements:**
- Clean, readable typography (good font size, line height, contrast)
- Scrollable if transcript is long
- Collapsible (for when user just wants video)
- Clear visual separation from video player

**Two video types to handle:**

| Video Type | Transcript Source | Display |
|------------|-------------------|---------|
| **Segment** | `recording-transcripts/{segment}.txt` | Single transcript file |
| **Chapter** | Multiple segment transcripts | Combined, with segment separators |

**Segment transcript:**
- Load from `recording-transcripts/01-1-intro.txt`
- Display as plain text, well formatted

**Chapter transcript:**
- Chapter videos combine multiple segments (e.g., `01-intro.mov` from `01-1`, `01-2`, `01-3`)
- Show all segment transcripts in order
- Add subtle separators between segments

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Transcript: Chapter 01 - Intro                           [Collapse â–¼]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”€â”€ 01-1-intro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                              â”‚
â”‚  Welcome to this video. Today we're going to look at...                      â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€ 01-2-intro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                              â”‚
â”‚  So continuing from where we left off...                                     â”‚
â”‚                                                                              â”‚
â”‚  â”€â”€ 01-3-intro-CTA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                              â”‚
â”‚  If you found this helpful, make sure to subscribe...                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Panel states:**

| State | Behavior |
|-------|----------|
| **Expanded** (default) | Shows transcript, scrollable |
| **Collapsed** | Just header bar, click to expand |
| **No transcript** | Shows "No transcript available" message |

**Future enhancement:** Sync transcript with video playback (highlight current section). Not in this FR.

---

#### 6. Persist Preferences

**Behavior:**
- Store selected speed AND size in localStorage
- On next visit, restore saved preferences
- Keys:
  - `flihub:watch:playbackSpeed` (e.g., `2`)
  - `flihub:watch:videoSize` (e.g., `normal`, `large`, `xl`)

---

#### UI Mockup (Normal Size)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Incoming] [Recordings] [Watch] [Transcripts] [Inbox] [Assets] ...          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚                                    â”‚                          â”‚
â”‚              â”‚           VIDEO PLAYER             â”‚                          â”‚
â”‚              â”‚                                    â”‚                          â”‚
â”‚              â”‚   [â–¶] â”â”â”â”â—â”â”â”â”â”â”â” 2:15 / 5:30    â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                              â”‚
â”‚              â–¶ Now playing: 10-1-demo.mov                                    â”‚
â”‚              Speed: [1x] [1.5x] [2xâ—] [2.5x] [3x] [4x]   Size: [Nâ—] [L] [XL] â”‚
â”‚                                                                              â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚  ğŸ“ Transcript                [â–¼]  â”‚                          â”‚
â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚              â”‚                                    â”‚                          â”‚
â”‚              â”‚  So this is where we're going to   â”‚                          â”‚
â”‚              â”‚  start building out the app. The   â”‚                          â”‚
â”‚              â”‚  first thing we need to do is set  â”‚                          â”‚
â”‚              â”‚  up the project structure...       â”‚                          â”‚
â”‚              â”‚                                    â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### Technical Notes

**HTML5 playbackRate:**
- Range: 0.07x to 16x (browser-enforced)
- Audio muted outside ~0.25x to 4x (browser-dependent)
- Set via: `videoRef.current.playbackRate = 2.0`

**Auto-select logic:**
```typescript
// Find most recent recording (highest chapter, then highest sequence)
const mostRecent = recordings
  .filter(r => r.folder !== 'safe')
  .sort((a, b) => {
    const chapterDiff = parseInt(b.chapter) - parseInt(a.chapter)
    if (chapterDiff !== 0) return chapterDiff
    return parseInt(b.sequence) - parseInt(a.sequence)
  })[0]
```

**Transcript loading:**
```typescript
// For segment video
const segmentTranscript = await fetch(`/api/query/projects/${code}/transcripts/${segmentName}`)

// For chapter video - need to load all segment transcripts for that chapter
const chapterTranscripts = await fetch(`/api/query/projects/${code}/transcripts?chapter=${chapterNum}&include=content`)
```

---

#### Related Brainstorming Ideas

From brainstorming notes (Video Watch Page):
- **Auto-advance:** Should it auto-play next segment when one finishes? (Future consideration)
- **Transcript sync:** Highlight current section as video plays (Future enhancement - not in this FR)
- **Safe videos:** Currently excluded - could be included with toggle

---

#### Acceptance Criteria

**Auto-select & Speed:**
- [ ] Watch page auto-loads the most recent recording on page load
- [ ] "Most recent" = highest chapter, then highest sequence
- [ ] Videos default to 2x playback speed
- [ ] Speed control bar shows with presets (1x, 1.5x, 2x, 2.5x, 3x, 4x)
- [ ] Clicking a preset changes playback speed immediately
- [ ] Current speed is visually indicated (highlighted/selected)

**Size toggle:**
- [ ] Size toggle shows 3 options: Normal, Large, Extra Large
- [ ] Default size is Normal
- [ ] Video and transcript panel scale together when size changes
- [ ] Video remains centered at all sizes

**Transcript panel:**
- [ ] Transcript panel appears below video player
- [ ] Panel has readable typography (good font size, line height)
- [ ] Panel is scrollable if content is long
- [ ] Panel is collapsible (expand/collapse toggle)
- [ ] For segment videos: shows single transcript file
- [ ] For chapter videos: shows combined transcripts with segment separators
- [ ] Shows "No transcript available" message when transcript not found

**Persistence:**
- [ ] Speed preference persists across page loads (localStorage)
- [ ] Size preference persists across page loads (localStorage)

**Integration:**
- [ ] Chapter panel still works correctly with all video sizes
- [ ] Transcript loads correctly when switching videos

---

### FR-61: Project Resolution Endpoint + Enhanced Project List

**As an external agent (Brand David)**, I want to resolve a project prefix to its full code and path, and get brand/path info from the projects list, so I can interact with projects without filesystem access.

---

#### Part 1: New Resolve Endpoint

Currently, to find a project by prefix (e.g., `b86`), external systems must:
1. Know the video-projects path
2. Run `ls | grep b86`
3. Parse the result

**Solution:** New API endpoint that resolves project prefixes:

```
GET /api/query/projects/resolve?q=b86
```

**Response:**
```json
{
  "success": true,
  "project": {
    "code": "b86-claudemas-01-jump",
    "brand": "appydave",
    "path": "/Users/.../v-appydave/b86-claudemas-01-jump"
  }
}
```

**Edge cases:**

| Scenario | Response |
|----------|----------|
| Exact match (`b86-claudemas-01-jump`) | Return that project |
| Prefix match (`b86`) | Return first matching project |
| Multiple matches (`b8`) | Return first match (alphabetically) |
| No match | `{ "success": false, "error": "No project found matching 'xyz'" }` |

---

#### Part 2: Add brand + path to Projects List

Enhance existing projects endpoint to include `brand` and `path` fields:

**Current response:**
```json
{
  "success": true,
  "projects": [
    {
      "code": "b86-claudemas-01-jump",
      "stage": "recording",
      "priority": "normal",
      "stats": { "recordings": 19, "chapters": 14 },
      "lastModified": "2025-12-14T05:02:57.853Z"
    }
  ]
}
```

**Enhanced response:**
```json
{
  "success": true,
  "projects": [
    {
      "code": "b86-claudemas-01-jump",
      "brand": "appydave",
      "path": "/Users/.../v-appydave/b86-claudemas-01-jump",
      "stage": "recording",
      "priority": "normal",
      "stats": { "recordings": 19, "chapters": 14 },
      "lastModified": "2025-12-14T05:02:57.853Z"
    }
  ]
}
```

**Brand derivation:** Extract from folder name: `v-appydave` â†’ `appydave`

---

#### Priority

High - low effort, big improvement for Brand David skill integration.

---

### FR-62: Rename to FliHub

**As a user**, I want the application header to say "FliHub" instead of "Recording Namer", so the name reflects what the app actually does now.

---

#### The Problem

The app was originally called "Recording Namer" when it just renamed recording files. It now handles:
- Video project management
- Assets (images, prompts, thumbnails)
- Transcripts and chapters
- Inbox for external content
- Query API for external integrations

The name "Recording Namer" no longer fits.

---

#### Solution

Simple text change in the header component.

**Before:** `Recording Namer > b75-project-name`

**After:** `FliHub > b75-project-name`

---

#### Scope

- Header component only
- Browser tab title (if applicable)
- Any other UI references to "Recording Namer"

---

### FR-63: Terminal Quick-Open Button

**As a content creator**, I want a button to quickly copy the project path for terminal access, so I can open a terminal in the project folder without navigating manually.

---

#### Context

The project dropdown already has a clipboard button that copies the recording name. This adds a similar button for terminal/path access.

---

#### Solution

Add a terminal-style button next to the existing clipboard button in the project dropdown.

**Behavior:** Copy full project path to clipboard.

Example: `/Users/davidcruwys/dev/video-projects/v-appydave/b86-claudemas-01-jump/`

---

#### UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  b86-claudemas-01-jump  â–¼    [ğŸ“‹] [>_]           â”‚
â”‚                               â†‘    â†‘             â”‚
â”‚                          existing  NEW           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Button styling:**
- Small black/dark button
- Terminal icon (e.g., `>_` or monospace style)
- Tooltip: "Copy project path"

---

#### Why Not Open iTerm Directly?

| Option | Pros | Cons |
|--------|------|------|
| Copy path | Simple, cross-platform | Extra paste step |
| Open iTerm | One click | macOS only, may need AppleScript |

**Decision:** Start with copy path. Can enhance to direct iTerm open later if needed.

---

### FR-59: Inbox Tab

**As a content creator**, I want an Inbox tab in FliHub to view and manage unlabeled incoming content, so I can stage raw materials before they're organized into the project structure.

---

#### Folder Structure

```
project/
â”œâ”€â”€ inbox/                  # Raw/unlabeled incoming content
â”‚   â”œâ”€â”€ raw/
â”‚   â”œâ”€â”€ dataset/
â”‚   â””â”€â”€ presentation/
â””â”€â”€ assets/
    â”œâ”€â”€ images/             # Images + prompts (.txt with same naming)
    â”œâ”€â”€ thumbs/             # YouTube thumbnails
    â””â”€â”€ resources/          # Labeled/finalized resources (Phase 2)
```

---

#### Key Concepts

| Folder | Purpose | Labeled? |
|--------|---------|----------|
| `inbox/` | Staging area for incoming content | No |
| `assets/images/` | Images aligned to video parts | Yes |
| `assets/thumbs/` | YouTube thumbnails | Yes |
| `assets/resources/` | Other finalized resources | Yes (Phase 2) |

**Inbox = unlabeled staging; assets = labeled/finalized content**

---

#### UI

New tab in FliHub alongside Recordings, Assets, Thumbnails.

**Tab order:** Recordings â†’ Inbox â†’ Assets â†’ Thumbnails

**Layout:** Grouped file list with separators (same pattern as chapter rows in Recordings).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FliHub > b75-project-name                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Recordings]  [Inbox]  [Assets]  [Thumbnails]                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Inbox (15 files)                                    [Open ğŸ“‚]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  raw (3 files Â· 224 KB)                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚      screenshot-01.png              124 KB           Dec 14     â”‚
â”‚      screenshot-02.png              98 KB            Dec 14     â”‚
â”‚      notes.txt                      2 KB             Dec 13     â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  dataset (empty)                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  presentation (12 files Â· 8.2 MB)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚      index.html                     45 KB            Dec 12     â”‚
â”‚      styles.css                     12 KB            Dec 12     â”‚
â”‚      assets/logo.svg                8 KB             Dec 12     â”‚
â”‚      slides/01-intro.html           124 KB           Dec 12     â”‚
â”‚      slides/02-overview.html        98 KB            Dec 12     â”‚
â”‚      ...                                                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key elements:**
- Group headers with file count + total size (like chapter rows)
- Files indented under their group
- Empty groups shown but minimal
- Presentations typically contain HTML + supporting assets

---

#### API Endpoints

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/query/projects/:code/inbox` | List inbox contents |
| POST | `/api/projects/:code/inbox/write` | Write file to inbox |

---

#### Phase 2: Resources

Resources in `assets/resources/` are **parked for now**. The Assets page needs UX revamp before adding more complexity. When ready, resources will follow the same labeled pattern as images/thumbs.

---

### FR-60: FliHub Skill Updates

**As a developer using Claude Code**, I want the FliHub skill updated to support new inbox features and health checks, so Brand David and other agents can interact with FliHub via API.

---

#### Skill Changes

| Current | New | Notes |
|---------|-----|-------|
| `querying-flihub` | `flihub` | Rename for clarity |

---

#### New Commands

| Command | Purpose |
|---------|---------|
| `health` | Check if FliHub server is running (uses existing health endpoint) |
| `write --target inbox` | Write content to project inbox |
| `write --target resources` | Write to resources (Phase 2, after inbox works) |

---

#### Health Endpoint

Use existing FliHub health endpoint (FR-28: Server Connection Indicator). The skill just exposes it for agents.

```
GET /api/health
```

---

#### Dependencies

- FR-59 (Inbox Tab) must be implemented first
- Resources write target deferred until Assets UX revamp

---

### FR-56: Chapter Navigation Panel

**As a content creator**, I want a fixed sidebar showing all chapters with timestamps, so I can see the chapter structure at a glance and navigate quickly while scrolling through recordings.

---

#### The Problem

On the Recordings page, when scrolling through many recordings:
- Can't see how many chapters exist
- Can't see the overall structure
- Have to scroll up/down to find specific chapters
- Chapter timestamps (from FR-34) are buried in chapter rows

---

#### Solution: Fixed Sidebar Panel

A table-of-contents style panel on the right side that:
- Lists all chapters with timestamps
- Shows chapter TITLE only (no video codes like "04")
- Stays fixed while the main content scrolls
- Provides quick navigation

---

#### UI Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Recording Namer > b71-bmad-poem                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                                 â”‚  â”‚  CHAPTERS (24)            â”‚â”‚
â”‚  â”‚  Project Recordings                             â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  118 files | 1:18:56        [ğŸ“„ Transcript]     â”‚  â”‚                           â”‚â”‚
â”‚  â”‚                                                 â”‚  â”‚  0:00  Introduction       â”‚â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  2:15  Setting up...      â”‚â”‚
â”‚  â”‚  Chapter 1: Intro  (4 files Â· 52s)              â”‚  â”‚  5:42  First demo         â”‚â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  8:30  Scenario           â”‚â”‚
â”‚  â”‚    01-1-intro.mov         11s   13.5 MB         â”‚  â”‚  12:15 Poem Planning  â—€   â”‚â”‚
â”‚  â”‚    01-2-intro.mov         11s   13.0 MB         â”‚  â”‚  18:42 Configuration      â”‚â”‚
â”‚  â”‚    ...                                          â”‚  â”‚  ...                      â”‚â”‚
â”‚  â”‚                                                 â”‚  â”‚                           â”‚â”‚
â”‚  â”‚  (scrollable)                                   â”‚  â”‚           [ğŸ“‹ Copy]       â”‚â”‚
â”‚  â”‚                                                 â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â–²                     â”‚
â”‚                                                              â”‚ FIXED               â”‚
â”‚                                                              â”‚ (doesn't scroll)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### Panel Contents

| Element | Description |
|---------|-------------|
| Header | "CHAPTERS (24)" - count of chapters |
| Chapter list | Timestamp + Title for each chapter |
| Current indicator | `â—€` or highlight showing which chapter is in view |
| Copy button | Copies YouTube-format chapter list to clipboard |

---

#### Chapter Display Format

**Show:** `0:00  Introduction`

**Don't show:** `0:00  01 Introduction` (no video codes)

The chapter title comes from the recording name, converted to Title Case with codes stripped:
- `01-1-poem-planning.mov` â†’ "Poem Planning"
- `04-2-setup-bmad-TECHSTACK.mov` â†’ "Setup Bmad" (tags stripped)

---

#### Behavior

| Action | Result |
|--------|--------|
| Scroll recordings | Panel stays fixed, current chapter indicator updates |
| Click chapter in panel | Scrolls main content to that chapter |
| Click Copy button | Copies YouTube-format chapter list to clipboard |
| Resize window | Panel collapses on narrow screens (responsive) |

---

#### Copy Output Format

YouTube-ready:
```
0:00 Introduction
2:15 Setting up the Environment
5:42 First Demo
8:30 Scenario
12:15 Poem Planning
```

---

#### Technical Notes

**Layout:**
- CSS Grid or Flexbox with `position: sticky` for panel
- Panel width: ~250-300px
- Main content: remaining width

**Current chapter detection:**
- Use Intersection Observer API
- Track which chapter heading is currently in viewport
- Update panel indicator accordingly

**Responsive:**
- On narrow screens (<1200px?), hide panel or make it collapsible
- Could add toggle button to show/hide

---

#### Files to Modify

| File | Changes |
|------|---------|
| `client/src/components/RecordingsView.tsx` | Add sidebar panel, layout changes |
| `client/src/components/ChapterPanel.tsx` | New component for the sidebar |
| `client/src/styles/` | Layout CSS for fixed sidebar |

---

#### Acceptance Criteria

- [ ] Fixed sidebar panel on Recordings page (right side)
- [ ] Shows chapter count in header
- [ ] Lists all chapters with timestamps (no video codes, just titles)
- [ ] Current chapter highlighted when scrolling
- [ ] Click chapter â†’ scrolls to that section
- [ ] Copy button â†’ YouTube-format chapter list in clipboard
- [ ] Responsive: hides/collapses on narrow screens
- [ ] Works with existing chapter data (no new API needed)

---

### FR-55: Video-Level Transcript Export

**As a content creator**, I want to export the combined transcript for my entire video from a modal, so I can copy it for use in other tools (ChatGPT, documentation, etc.).

---

#### Context

Currently on the Recordings page:
- Each chapter has `ğŸ“‹ All` and `Combine` buttons for chapter-level transcripts
- These are rarely used (transcription is automatic)
- There's no way to get the ENTIRE video's transcript in one click

---

#### Solution: Video-Level Export Button + Modal

Add a button at the video level (top of Recordings page) that opens a modal with the combined transcript.

---

#### UI - Button Location

In the header area of Recordings page:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Project Recordings                                              â”‚
â”‚  118 files (118 active, 0 safe) | 1:18:56 | 24 chapters         â”‚
â”‚                                                                  â”‚
â”‚  [ğŸ“„ Transcript]                                                 â”‚
â”‚       â†‘                                                          â”‚
â”‚  Click to open modal                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### UI - Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Video Transcript                                           [âœ•] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Chapter 1: Introduction                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  So in this video we're going to look at how to set up the      â”‚
â”‚  recording namer application. First thing you need to do is     â”‚
â”‚  make sure you have Node.js installed on your computer...       â”‚
â”‚                                                                  â”‚
â”‚  Chapter 2: Setting up the Environment                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚  Let's start by cloning the repository from GitHub. Open your   â”‚
â”‚  terminal and navigate to your projects directory...            â”‚
â”‚                                                                  â”‚
â”‚  (scrollable content)                                            â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    [ğŸ“‹ Copy]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### Modal Contents

**Format:**

```
Chapter 1: Introduction
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[transcript text for chapter 1, all sequences combined]

Chapter 2: Setting up the Environment
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
[transcript text for chapter 2, all sequences combined]

...
```

**Notes:**
- Chapter headers use TITLE (not video codes) - same as FR-56
- Each chapter's transcript is the combined text from all sequences
- Blank line between chapters for readability

---

#### Behavior

| Action | Result |
|--------|--------|
| Click `[ğŸ“„ Transcript]` button | Modal opens with combined transcript |
| Click `[ğŸ“‹ Copy]` | Copies entire transcript to clipboard, toast confirmation |
| Click `[âœ•]` or outside modal | Modal closes |
| Press Escape | Modal closes |

---

#### Technical Notes

**Data source:**
- Use existing transcript data (same as chapter-level Combine)
- Combine all chapters in order
- Already have the text in `recording-transcripts/` folder

**API:**
- May need new endpoint: `GET /api/projects/:code/transcript/combined`
- Or extend existing transcript endpoint with `?combined=true`

**Ordering:**
- Chapters sorted by number (01, 02, 03...)
- Within chapter, sequences sorted (01-1, 01-2, 01-3...)

---

#### Files to Modify

| File | Changes |
|------|---------|
| `client/src/components/RecordingsView.tsx` | Add Transcript button in header |
| `client/src/components/TranscriptModal.tsx` | New modal component |
| `server/src/routes/transcripts.ts` | Add combined endpoint (if needed) |

---

#### Acceptance Criteria

- [ ] `[ğŸ“„ Transcript]` button in Recordings page header
- [ ] Click opens modal with combined transcript
- [ ] Transcript organized by chapter with headers
- [ ] Chapter headers show titles (not video codes)
- [ ] Copy button copies entire content to clipboard
- [ ] Toast confirmation on copy
- [ ] Modal closes on X, click outside, or Escape

---

### FR-57: Parallelize ffprobe Calls

**Performance fix** - The Recordings page is slow because ffprobe calls run sequentially.

---

#### The Problem

`GET /api/recordings` calls ffprobe for each file **sequentially** (await inside for-loop).

| Files | Current Behavior | Impact |
|-------|------------------|--------|
| 118 files | 118 Ã— sequential ffprobe | 5+ second delays |
| Each ffprobe | ~50ms | Adds up linearly |

**Location:** `server/src/routes/index.ts:398-416`

```typescript
// CURRENT: Sequential (slow)
for (const entry of entries) {
  if (entry.isFile()) {
    const recording = await processFile(filePath, 'recordings');  // â† blocks
    if (recording) recordings.push(recording);
  }
}
```

---

#### Solution: Parallelize

Run all ffprobe calls simultaneously using `Promise.all`.

```typescript
// NEW: Parallel (fast)
const recordingPaths = entries
  .filter(e => e.isFile())
  .map(e => path.join(paths.recordings, e.name));

const results = await Promise.all(
  recordingPaths.map(fp => processFile(fp, 'recordings'))
);

recordings.push(...results.filter(Boolean));
```

**Expected improvement:** 5+ seconds â†’ ~100-200ms

---

#### Why Not Caching?

We considered caching durations in a per-project JSON file, but:
1. FliHub is currently stateless (no per-project config files exist)
2. Per-project JSON files will cause git merge conflicts when team shares via GitHub
3. Parallelization is simpler and sufficient for the performance goal

See brainstorming notes for full architectural discussion on per-project state.

---

#### Files to Modify

| File | Changes |
|------|---------|
| `server/src/routes/index.ts` | Refactor loops at lines 398-404 and 408-416 to use Promise.all |

---

#### Acceptance Criteria

- [ ] Recordings list loads in <500ms (not 5+ seconds)
- [ ] All recordings still display correctly
- [ ] Durations still populate for all files
- [ ] Works for both `recordings/` and `safe/` folders

---

### FR-54: Naming Template Bugs

**Bug collection** - Four related issues with the automatic naming template on the Incoming tab.

---

#### Bug 1: Custom tag cleared after rename

**Current behavior:** After renaming a file, the custom tag field is cleared automatically.

**Expected behavior:** Custom tag should persist until the user explicitly clears it.

**Root cause:** `App.tsx:121-127` - `handleRenamed` explicitly sets `customTag: ''`

**Fix:**
- Remove `customTag: ''` from `handleRenamed`
- Add a small "Ã—" clear button next to the custom tag input

---

#### Bug 2: Tags appearing in suggested name

**Current behavior:** When suggesting next name, tags (uppercase words like `TECHSTACK`, `CTA`) are included in the name field.

**Example:** After renaming to `12-8-winston-architect-TECHSTACK.mov`, the next suggestion shows name as `winston-architect-TECHSTACK` instead of `winston-architect`.

**Root cause:** `shared/naming.ts:189` - `parseRecordingFilename` returns `name: parts.slice(2).join('-')` which includes tags.

**Fix:** Strip uppercase-only words (tags) from the end of the name in `parseRecordingFilename` or in `calculateSuggestedNaming`.

---

#### Bug 3: Sequence limited to single digit

**Current behavior:** Cannot type "13" in sequence field - limited to 1 character.

**Example:** Project b71 has sequences up to 28, but user can't manually enter two-digit sequences.

**Root cause:** `NamingControls.tsx:82` - `e.target.value.slice(0, 1)` and `maxLength={1}`

**Fix:** Change to `slice(0, 3)` and `maxLength={3}` (allow up to 999 takes per chapter).

---

#### Bug 4: Can't enter multiple custom tags

**Current behavior:** Custom tag input is too small and only allows single tag.

**Expected behavior:** Support multiple tags separated by dash.

**Root cause:** `NamingControls.tsx:157` - Input width is `w-16` (64px), too narrow for multiple tags.

**Fix:**
- Widen input to `w-24` or `w-32`
- The `sanitizeCustomTag` function already converts spaces/commas to dashes, so `TAG1 TAG2` â†’ `TAG1-TAG2` should work
- Update placeholder to hint at format: `"TAG"` or `"TAG1-TAG2"`

---

#### Files to Modify

| File | Changes |
|------|---------|
| `client/src/App.tsx` | Remove `customTag: ''` from `handleRenamed` |
| `client/src/components/NamingControls.tsx` | Sequence maxLength, custom tag width, clear button |
| `shared/naming.ts` | Strip tags from name in `parseRecordingFilename` or `calculateSuggestedNaming` |

---

#### Acceptance Criteria

- [ ] Custom tag persists after rename (until cleared manually)
- [ ] Clear button (Ã—) next to custom tag input
- [ ] Suggested name excludes uppercase tags (TECHSTACK, CTA, etc.)
- [ ] Sequence field allows 2-3 digits
- [ ] Custom tag input wider, supports dash-separated multiple tags

---

### FR-53: ASCII Report Formatter

**As an LLM agent or power user**, I want to retrieve project data as formatted ASCII reports, so I can quickly understand project status in terminal output or LLM context without parsing JSON.

---

#### Context

NFR-8 (Project Data Query API) provides structured JSON endpoints for querying project data. While JSON is great for programmatic access, it's hard to read in terminal output or when feeding context to LLMs.

**Inspiration:** The DAM tool in `appydave-tools` uses excellent terminal formatting:
- ASCII tables with column alignment
- Emoji status indicators (âœ… âŒ âš ï¸)
- Contextual headers and summary footers
- Human-readable sizes (`1.5 GB`) and times (`3d ago`)

---

#### Requirements

**1. Add `?format=text` query parameter to NFR-8 endpoints**

When `format=text` is specified, return `Content-Type: text/plain` with formatted ASCII output instead of JSON.

| Endpoint | ASCII Report |
|----------|--------------|
| `GET /api/query/projects?format=text` | Project list table |
| `GET /api/query/projects/:code?format=text` | Project summary |
| `GET /api/query/projects/:code/recordings?format=text` | Recordings table |
| `GET /api/query/projects/:code/transcripts?format=text` | Transcripts table |
| `GET /api/query/projects/:code/chapters?format=text` | Chapter list (YouTube-ready) |
| `GET /api/query/projects/:code/images?format=text` | Images table |
| `GET /api/query/projects/:code/export?format=text` | Full project report |

**Default:** Without `?format=text`, endpoints continue returning JSON (backward compatible).

---

**2. Report Formats**

##### Projects List

```
ğŸ“‚ FliHub Projects                                              2025-12-07 14:30

PROJECT                              STAGE    CH   FILES    ğŸ“„     ğŸ¬
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“Œ b72-flivideo-demo                 EDIT     12      28   100%    âœ…
ğŸ“Œ b74-opus-multi-agent              REC       4       8     0%    âŒ
   b67-vam-s3-staging                -         0       0      -    âŒ
   b71-context-engineering           EDIT      9      19   100%    âœ…

Total: 13 projects | 4 pinned | 156 recordings
```

##### Project Summary

```
ğŸ“‚ Project: b72-flivideo-demo
   Stage: EDIT | Priority: pinned
   Path: ~/dev/video-projects/v-appydave/b72-flivideo-demo

STATS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Recordings:     28
Safe:           12
Chapters:       12
Transcripts:    28/28 (100%)
Images:         8
Thumbnails:     3
Duration:       47:32

FINAL MEDIA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Video:   âœ… b72-final-v2.mp4 (4.1 GB)
SRT:     âœ… b72-final-v2.srt

Created: 2025-11-28 | Last modified: 3 days ago
```

##### Recordings Table

```
ğŸ“‚ Recordings: b72-flivideo-demo

RECORDING                                        SIZE      DURATION   ğŸ“„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”€â”€ Chapter 01: intro â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   01-1-intro.mov                              145.3 MB      2:34    âœ…
   01-2-intro-CTA.mov                           89.7 MB      1:23    âœ…
â”€â”€ Chapter 02: setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   02-1-setup.mov                              234.1 MB      4:12    âœ…
   02-2-setup.mov                              178.5 MB      3:01    âš ï¸ missing

Total: 28 recordings | 1.2 GB | 47:32 duration
Transcripts: 26/28 (93%)
```

##### Chapters (YouTube-ready)

```
ğŸ“‚ Chapters: b72-flivideo-demo

00:00 Intro
02:34 Setting up the Project
05:12 First Implementation
08:45 Testing and Debugging
12:30 Final Demo
15:22 Outro

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6 chapters | Ready for YouTube description
```

##### Transcripts Table

```
ğŸ“‚ Transcripts: b72-flivideo-demo

TRANSCRIPT                                       SIZE     PREVIEW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
01-1-intro.txt                                  4.5 KB   Welcome to this tutorial...
01-2-intro-CTA.txt                              2.1 KB   Don't forget to subscribe...
02-1-setup.txt                                  8.3 KB   Let's start by setting up...

Total: 26 transcripts | 145 KB
```

##### Full Export Report

Combines all sections into one comprehensive report:

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         FliHub Project Export
                         b72-flivideo-demo
                         Generated: 2025-12-07 14:30
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[Project Summary section]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[Chapters section]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[Recordings section]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[Transcripts section - with content if ?include=content]

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

**3. Formatting Utilities**

Create `server/src/utils/formatters.ts`:

```typescript
// Human-readable file size
formatSize(bytes: number): string
// â†’ "1.5 GB", "234.2 MB", "45.8 KB"

// Relative time
formatAge(date: Date): string
// â†’ "just now", "3h ago", "2d ago", "1w ago"

// Duration from seconds
formatDuration(seconds: number): string
// â†’ "2:34", "1:02:34"

// Path shortening
shortenPath(path: string): string
// â†’ "~/dev/video-projects/..."

// Table row formatting
formatRow(columns: string[], widths: number[]): string
// â†’ "col1      col2        col3"

// Divider line
divider(char: string, width: number): string
// â†’ "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
```

---

**4. Update `flihub` Claude Code Skill**

The existing `flihub` skill in `.claude/skills/flihub.md` should document the `?format=text` option so LLM agents know to use it when gathering context.

---

#### Technical Notes

**Implementation location:**
- Formatter utilities: `server/src/utils/formatters.ts`
- Report generators: `server/src/utils/reporters.ts` (or inline in routes)
- Skill update: `.claude/skills/flihub.md`

**Response handling:**
```typescript
// In route handler
if (req.query.format === 'text') {
  res.setHeader('Content-Type', 'text/plain; charset=utf-8');
  return res.send(formatProjectsReport(projects));
}
// Default JSON response
res.json({ success: true, projects });
```

**Emoji compatibility:**
- Terminal emojis work in most modern terminals (iTerm2, VS Code, etc.)
- Fallback to ASCII if needed: `[OK]` instead of `âœ…`

---

#### Acceptance Criteria

- [x] All NFR-8 endpoints support `?format=text` parameter
- [x] Text output is `Content-Type: text/plain`
- [x] Reports use consistent formatting (headers, dividers, footers)
- [x] Emoji status indicators match DAM patterns
- [x] File sizes formatted as human-readable (KB, MB, GB)
- [x] Dates shown as relative time where appropriate
- [x] Paths shortened with `~` for home directory
- [x] Export report combines all sections coherently
- [x] `flihub` skill documentation updated

---

### FR-52: Transcription Progress Bar

**As a content creator**, I want to see an overall progress summary at the top of the Transcriptions page, so I can quickly understand how much transcription work is complete vs remaining.

**Implementation:**
- Progress bar component showing project-wide transcription status
- Visual bar with percentage (e.g., "12/15 files (80%)")
- Status chips: âœ“ complete | â³ active | ğŸ“‹ queued | âš  missing
- Conditional display (active/queued/missing only shown when > 0)
- Real-time updates via socket events
- Shows "All recordings transcribed!" when 100% complete

---

### FR-32: Improved Project List Columns

**As a content creator**, I want the Projects list to show more useful metrics at a glance, so I can quickly understand project status and identify what needs attention.

---

#### Priority/Focus System

Two states only (simple toggle):

| State | Icon | Meaning |
|-------|------|---------|
| Pinned | ğŸ“Œ | Important, keep at top of list |
| Normal | (blank) | Default state |

**Behaviour:**
- Click to toggle: blank â†” ğŸ“Œ
- Multiple projects can be ğŸ“Œ
- Priority state persisted (see Data Storage below)
- Note: The blue row highlight already shows the currently selected/active project, so ğŸ”¥ is not needed

---

#### Column Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     â”‚ Project Code              â”‚ Stage â”‚ Ch â”‚ Files â”‚  ğŸ“„  â”‚ â“˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Œ â”‚ b72-flivideo-demo         â”‚ EDIT  â”‚ 12 â”‚    28 â”‚ 100% â”‚ â“˜            â”‚
â”‚  ğŸ“Œ â”‚ b74-opus-multi-agent      â”‚  REC  â”‚  4 â”‚     8 â”‚   0% â”‚ â“˜            â”‚
â”‚     â”‚ b67-vam-s3-staging        â”‚   -   â”‚  0 â”‚     0 â”‚   -  â”‚ â“˜            â”‚
â”‚     â”‚ b71-context-engineering   â”‚ EDIT  â”‚  9 â”‚    19 â”‚ 100% â”‚ â“˜            â”‚
â”‚     â”‚ b75-vibe-code-whisper     â”‚  REC  â”‚  7 â”‚    15 â”‚  80% â”‚ â“˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Column | Width | Content |
|--------|-------|---------|
| Priority | ~24px | ğŸ“Œ / blank (clickable to toggle) |
| Project Code | flex | `b75-vibe-code-whisper` |
| Stage | ~50px | `REC` `EDIT` `DONE` `-` |
| Ch | ~30px | Unique chapter count |
| Files | ~45px | Recordings + Safe combined |
| ğŸ“„ | ~45px | Transcription % (or `-`) |
| â“˜ | ~24px | Hover for stats popup |

---

#### Stage Values

| Badge | Colour | Condition |
|-------|--------|-----------|
| `-` | Gray | 0 files |
| `REC` | Blue | Recording phase |
| `EDIT` | Yellow | Editing phase |
| `DONE` | Green | Published/complete |

**Auto-detection (default):**
- 0 files â†’ `-`
- Has files, < 100% transcribed â†’ `REC`
- 100% transcribed â†’ `EDIT`

**Manual override:**
- Click the stage badge to cycle: `REC` â†’ `EDIT` â†’ `DONE` â†’ (auto)
- Clicking past `DONE` returns to auto-detection
- Manual stages show a subtle ring indicator
- Manual stages persist until user clicks back to auto

---

#### Files Count Fix

**Current:** Only counts files in `recordings/`
**Required:** Count files in `recordings/` + `recordings/-safe/`

---

#### Transcription Percentage

Formula: `(transcripts count) / (recordings + safe count) * 100`

| Value | Display |
|-------|---------|
| No files | `-` |
| 0% | `0%` |
| 1-99% | `XX%` |
| 100% | `100%` (or âœ“) |

---

#### â“˜ Stats Popup (Hover)

On hover, show tooltip/popover with extended stats:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  b75-vibe-code-whisper  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Created:    Nov 28     â”‚
â”‚  Last edit:  3 days ago â”‚
â”‚  Duration:   47 min     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Recordings: 12         â”‚
â”‚  Safe:       3          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Images:     8          â”‚
â”‚  Thumbs:     4          â”‚
â”‚  Transcripts:12/15 (80%)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Stats to include:**
- Created date (folder creation or earliest file)
- Last edit (most recent file modification)
- Total duration (sum of all video durations, if available)
- Recordings count (in `recordings/`)
- Safe count (in `recordings/-safe/`)
- Images count (in `assets/images/`)
- Thumbs count (in `assets/thumbs/`)
- Transcripts: X/Y (Z%)

---

#### Sorting Order

1. ğŸ“Œ pinned projects first (by project code ascending: b67, b68...)
2. Normal projects (by project code ascending: b67, b68...)

---

#### Data Storage

Priority state needs persistence:

```json
// server/config.json
{
  "pinnedProjects": ["b74-opus-multi-agent", "b72-flivideo-demo"]
}
```

Simple array of pinned project codes. Absent = not pinned.

---

#### UI Mockup - Full Width

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AppyDave Projects (13 projects)                                      [+ New]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚ Project Code                    â”‚ Stage â”‚ Ch â”‚ Files â”‚  ğŸ“„   â”‚              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Œ â”‚   b72-flivideo-recording-demo   â”‚ EDIT  â”‚ 12 â”‚    28 â”‚ 100%  â”‚ â“˜           â”‚
â”‚  ğŸ“Œ â”‚   b74-multi-agent-workflows     â”‚  REC  â”‚  4 â”‚     8 â”‚   0%  â”‚ â“˜           â”‚
â”‚     â”‚   b67-vam-s3-staging            â”‚   -   â”‚  0 â”‚     0 â”‚   -   â”‚ â“˜           â”‚
â”‚     â”‚   b68-prompt-engineering        â”‚  REC  â”‚  2 â”‚     3 â”‚   0%  â”‚ â“˜           â”‚
â”‚     â”‚   b69-skool-community           â”‚  REC  â”‚  3 â”‚     5 â”‚  40%  â”‚ â“˜           â”‚
â”‚     â”‚   b70-bmad-method-intro         â”‚ EDIT  â”‚  6 â”‚    14 â”‚ 100%  â”‚ â“˜           â”‚
â”‚     â”‚   b71-context-engineering       â”‚ EDIT  â”‚  9 â”‚    19 â”‚ 100%  â”‚ â“˜           â”‚
â”‚     â”‚ â–¸ b75-vibe-code-whisper-opus    â”‚  REC  â”‚  7 â”‚    15 â”‚  80%  â”‚ â“˜    â† blue â”‚
â”‚     â”‚   ...                           â”‚       â”‚    â”‚       â”‚       â”‚              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  + Add new project...                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

*Pinned projects at top (ascending), then normal projects (ascending). Blue row = selected.*

---

#### Interactions

| Action | Target | Result |
|--------|--------|--------|
| Click | Priority cell (ğŸ“Œ/blank) | Toggle pinned state |
| Click | Row (anywhere else) | Switch to project |
| Hover | â“˜ icon | Show stats popup |

---

#### Out of Scope (Deferred to FR-31)

- Notes/description field
- Archive/hide projects
- Manual stage override
- Full DAM integration
- Project metadata editing

### FR-25: Assigned Assets Row Cleanup

**As a content creator**, I want the Assigned Assets rows to be cleaner and show relevant information, so I can quickly scan my assets.

**Changes:**

1. **Remove `[â†‘ label]` button**
   - No longer needed - clicking any row now populates the controls
   - Delete the button and associated code

2. **Add variant badge**
   - When a file has a variant letter (a, b, c), show a small badge
   - Example: `10-6-1a-bigpicture.png` shows `[A]` badge
   - Styling: small, subtle badge after filename

3. **Show file extension**
   - Currently: `10-6-1a-bigpicture`
   - Should be: `10-6-1a-bigpicture.png`
   - Show the actual extension (`.png`, `.jpg`, `.webp`)

4. **Remove date column**
   - The date/timestamp is not useful information
   - Remove from display to reduce clutter

**Keep as-is:**
- Blue/yellow left border - indicates chapter grouping (images within same video segment)
- Prompt text area display - already shows when prompt exists

**Mockup (before):**
```
[thumb]  10-6-john-product-manager  10-6-1a-bigpicture  [â†‘label]  3.0 MB  29/11/2025
```

**Mockup (after):**
```
[thumb]  10-6-john-product-manager  10-6-1a-bigpicture.png  [A]  3.0 MB
```

---

### FR-26: Paired Asset Display with Prompt Preview

**Status:** âœ… Implemented 2025-12-01

**As a content creator**, I want images and their prompts shown on a single row, so I can see the relationship between them.

**Features:**
- Images and prompts with same base filename grouped on one row
- Prompt text displays inline in multi-line text area (height scales with thumbnail size)
- Shift+Hover on prompt text shows full content in modal overlay with line breaks preserved
- Shift+Hover on thumbnail shows large image preview (existing FR-20)
- Click anywhere on row populates ALL assignment controls including prompt text
- Prompt-only assets show placeholder thumbnail with ğŸ“ icon

---

### FR-24: Image Source Directory in Config

**Status:** âœ… Implemented 2025-12-01

**As a content creator**, I want to see and edit the Image Source Directory in the Config screen, so I can change where incoming images are scanned from.

**Implementation:**
- Added "Image Watch Directory" field to ConfigPanel
- Same validation as other path fields (must start with ~ or /)
- Renamed existing labels for clarity:
  - "Watch Directory" â†’ "Ecamm Watch Directory"
  - "Target Directory" â†’ "Target Project Directory"
- Show with collapsed path (using `~`)

**UI:**
```
Watch Directory:        [~/ecamm_________________]
                        Directory where Ecamm Live saves recordings

Target Directory:       [~/dev/video-projects/.../recordings]
                        Directory where renamed files will be moved

Image Source Directory: [~/Downloads_____________]
                        Directory to scan for incoming images (Assets page)

                                    [Save]
```

**Technical notes:**
- Add `imageSourceDirectory` to ConfigPanel state
- Include in `useUpdateConfig` mutation
- Already exists in backend config handling

---

### FR-23: Thumbnail Size Toggle

**As a content creator**, I want to change the thumbnail size in the Assets page, so I can scan through many images quickly (small) or see more detail (large/extra-large).

**Applies to:**
- Incoming images grid
- Assigned images list

**UI:**

Small button bar below the Assignment Controls section header:

```
INCOMING IMAGES (~/Downloads)                    [S] [M] [L] [XL]
```

**Sizes:**

| Size | Thumbnail | Use case |
|------|-----------|----------|
| S (Small) | ~80px | Quick scan, see many at once |
| M (Medium) | ~120px | Balanced view |
| L (Large) | ~160px | Current default, good detail |
| XL (Extra Large) | ~240px | Maximum detail without Shift+Hover |

**Behavior:**
- Default: Large (L)
- Clicking a size button applies to both Incoming and Assigned grids
- Persist selection in localStorage (remembers across sessions)
- Active size button highlighted

**Mockup:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INCOMING IMAGES (~/Downloads)              [S] [M] [L] [XL]    â”‚
â”‚                                                                  â”‚
â”‚  [Small view - many thumbnails fit]                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”      â”‚
â”‚  â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚ â”‚    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                  â”‚
â”‚  [Large view - fewer thumbnails, more detail]                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚          â”‚ â”‚          â”‚ â”‚          â”‚ â”‚          â”‚           â”‚
â”‚  â”‚          â”‚ â”‚          â”‚ â”‚          â”‚ â”‚          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical notes:**
- Frontend only, no backend changes
- Store size preference in localStorage
- Apply size via CSS class or inline style on thumbnail container
- Button bar styling: small, subtle, doesn't dominate the UI

---

### FR-21: Custom Tag Input

**As a content creator**, I want to add a custom tag when renaming a recording, so I can add a quick note or label for edge cases without modifying the config.

**Use case:** You have 15 recordings in a chapter and one covers something specific (e.g., a sponsor mention, a blooper, a retake of a specific point). You want a quick label without adding it to the global config.

**UI:**

Small inline text input at the end of the tags row:

```
Tags: [CTA] [SKOOL]  [ENDCARD]  [_______]
                                â””â”€ placeholder: "custom"
```

**Behavior:**
- Small text input field after existing tag buttons
- Placeholder: "custom" (or similar)
- Type text, press Enter or blur â†’ converts to UPPERCASE and adds to filename
- Commas in input become dashes (e.g., "sponsor,intro" â†’ "SPONSOR-INTRO")
- Multiple custom tags: type comma-separated values in single field
- Not persisted - one-off per rename, field clears after rename
- Treated same as other tags in filename output

**Visual styling:**
- Input field: subtle, doesn't draw attention
- No special styling needed once in filename - it's just another tag

**Example:**
```
Input: "sponsor note"
Filename: 03-15-demo-CTA-SPONSOR-NOTE.mov
```

**Technical notes:**
- Frontend only - no backend changes
- Add to existing tags array before building filename
- Sanitize input: uppercase, replace spaces/commas with dashes, strip invalid chars

---

### FR-8: Improved "Good Take" Detection Algorithm

**Status:** âœ… v2 Implemented 2025-11-29

**Full specification:** `docs/recording-namer/good-take-algorithm.md`

**As a content creator**, when multiple recordings are in the incoming files list, I want the "likely good take" highlighting to correctly identify the best recording.

**v2 Implementation (commit db85daf):**
- Files < 5MB treated as junk (always white)
- First substantial file (â‰¥5MB) = baseline
- Most recent substantial file = best take (green)
- Baseline = good take (yellow) when a better take exists
- Single substantial file = green (it's the best)

**Behavior:**
| Scenario | Baseline | Junk | Best Take |
|----------|----------|------|-----------|
| Baseline + junk only | ğŸŸ¢ Green | â¬œ White | - |
| Baseline + better take | ğŸŸ¡ Yellow | â¬œ White | ğŸŸ¢ Green |
| Single file | ğŸŸ¢ Green | - | - |
| Only junk files | Most recent = ğŸŸ¢ | â¬œ White | - |

**Test Cases:** 8 scenarios documented in spec file - need to verify all pass

---

### FR-9: Default Port Configuration

**As a content creator**, I want the application to run on predictable ports, so I can access Recording Namer without conflicts with other dev apps.

**Port scheme:**
- Client (Vite): 5100
- Server (Express): 5101

**Pattern:** Base port + 1 for API. Future apps can use 5200/5201, 5300/5301, etc.

---

### FR-10: Project List Panel

**As a content creator**, I want to see a panel listing all available AppyDave video projects, so I can understand what projects exist before needing to switch between them.

**Context:**
- Projects are managed by DAM (Digital Asset Management) tool
- Specifically AppyDave brand projects (e.g., `v-appydave/b72-opus-awesome/`)
- Simpler first step before building project switching

**Requirements:**
- Scan available projects using DAM integration
- Display read-only list of projects with codes/names
- Show basic info (project code, maybe file count or last modified)

**Integration:**
- Use existing DAM skill/tool for project discovery
- Project path pattern: `/dev/video-projects/v-appydave/{project-code}/`

**UI:**
- New panel/section in the UI (togglable like Config panel)
- List view of available projects

---

### FR-11: Project Selector/Switcher

**As a content creator**, I want to switch projects by clicking on a project code in the project list, so I can quickly change target folders without manual path entry.

**Depends on:** FR-10 (Project List Panel)

**Requirements:**
- Click on a project code in the project list to switch to it
- Switching updates the target directory in config to `{project-path}/recordings/`
- Persist selected project across sessions

**UI:**
- Clickable project codes in the Projects panel
- Visual indication of currently selected project
- Show current project name prominently in header or footer

---

### FR-12: Create New Project

**As a content creator**, I want to create a new video project from the Recording Namer, so I can start a new project without leaving the application.

**Requirements:**
- Input field for project code (e.g., "b73-new-topic")
- Create project folder at `~/dev/video-projects/v-appydave/{project-code}/`
- Create `recordings/` subdirectory inside the project
- Automatically switch to the new project after creation
- Validate project code format (kebab-case, starts with b-number pattern)

**UI:**
- "New Project" button in Projects panel
- Modal or inline form for entering project code
- Success/error feedback via toast

---

---

## Non-Functional Requirements

| # | Requirement | Added | Status |
|---|-------------|-------|--------|
| 1 | NFR-1: Dynamic CORS origins (see below) | 2025-11-29 | âœ… Implemented 2025-11-29 |
| 2 | NFR-2: Configurable tags via JSON (see below) | 2025-11-29 | âœ… Implemented 2025-11-29 |
| 3 | NFR-3: Configurable common names with rules (see below) | 2025-11-29 | âœ… Implemented 2025-11-29 |
| 4 | NFR-4: Rename "subsequence" to "sequence" (see below) | 2025-11-29 | âœ… Implemented 2025-11-29 |
| 5 | NFR-5: Extend Socket Infrastructure (see below) | 2025-12-01 | âœ… Implemented 2025-12-01 |
| 6 | NFR-6: Codebase Refactor (see below) | 2025-12-01 | âœ… Implemented 2025-12-03 |
| 7 | NFR-7: Show Recording Duration (see below) | 2025-12-02 | âœ… Implemented 2025-12-02 |
| 8 | NFR-8: Project Data Query API (see spec) | 2025-12-06 | âœ… Implemented 2025-12-06 |
| 9 | NFR-9: Extract getProjectStats() utility (see below) | 2025-12-13 | Pending |
| 10 | NFR-10: Consolidate formatting utilities (see below) | 2025-12-13 | Pending |
| 11 | NFR-11: Extract file scanning utilities (see below) | 2025-12-13 | Pending |
| 12 | NFR-12: Extract API_URL config (see below) | 2025-12-13 | Pending |

---

### NFR-9: Extract getProjectStats() Utility

**Refactor** - query.ts is 1289 lines with the same project stats calculation repeated 3 times.

---

#### The Problem

The following logic is duplicated at lines ~307, ~410, and ~984 in `server/src/routes/query.ts`:
- `countMovFiles()` - counting recordings
- `getTranscriptSyncStatus()` - checking transcript sync
- Stage detection logic
- File counting patterns

---

#### Solution

Extract a single `getProjectStats()` function that returns:

```typescript
interface ProjectStats {
  recordingCount: number;
  safeCount: number;
  transcriptCount: number;
  transcriptSyncStatus: 'synced' | 'partial' | 'none';
  imageCount: number;
  thumbCount: number;
  stage: 'recording' | 'editing' | 'done';
  totalDuration: number | null;
}

async function getProjectStats(projectPath: string): Promise<ProjectStats>
```

---

#### Files to Modify

| File | Changes |
|------|---------|
| `server/src/routes/query.ts` | Extract function, replace 3 call sites |
| `server/src/utils/projectStats.ts` | New file with extracted function |

---

#### Expected Impact

- Reduce query.ts from ~1289 lines to ~850 lines
- Single source of truth for stats calculation
- Easier to maintain and test

---

#### Acceptance Criteria

- [ ] `getProjectStats()` function extracted to utils
- [ ] All 3 duplicate locations use the new function
- [ ] No change in API responses (same data returned)
- [ ] query.ts reduced by ~400 lines

---

### NFR-10: Consolidate Formatting Utilities

**Quick win** - `formatFileSize()` implemented in 3 different places.

---

#### The Problem

Formatting functions are scattered across the codebase:

| Function | Locations |
|----------|-----------|
| `formatFileSize()` | `utils/`, `ProjectStatsPopup`, `ThumbsPage` |
| Timestamp formatting | `RecordingsView`, `AssetsPage`, `ProjectStatsPopup` (all slightly different) |

There's already a `client/src/utils/formatting.ts` that should be the single source.

---

#### Solution

1. Ensure `client/src/utils/formatting.ts` has all needed formatters
2. Remove duplicate implementations
3. Import from `utils/formatting.ts` everywhere

---

#### Files to Modify

| File | Changes |
|------|---------|
| `client/src/utils/formatting.ts` | Add any missing formatters |
| `client/src/components/ProjectStatsPopup.tsx` | Use shared formatter |
| `client/src/components/ThumbsPage.tsx` | Use shared formatter |
| `client/src/components/RecordingsView.tsx` | Use shared formatter |
| `client/src/components/AssetsPage.tsx` | Use shared formatter |

---

#### Acceptance Criteria

- [ ] Single `formatFileSize()` in `utils/formatting.ts`
- [ ] Consistent timestamp formatting across all components
- [ ] No duplicate formatting functions in component files

---

### NFR-11: Extract File Scanning Utilities

**Medium priority** - Similar `fs.readdir()` + filter patterns repeated across routes.

---

#### The Problem

`query.ts`, `index.ts`, and `projects.ts` all have similar patterns:
```typescript
const entries = await fs.readdir(dir, { withFileTypes: true });
const files = entries.filter(e => e.isFile() && e.name.endsWith('.mov'));
```

---

#### Solution

Create `server/src/utils/scanning.ts` with reusable functions:

```typescript
async function scanMovFiles(dir: string): Promise<string[]>
async function scanImageFiles(dir: string): Promise<string[]>
async function scanDirectory(dir: string, options: ScanOptions): Promise<FileEntry[]>
```

---

#### Files to Modify

| File | Changes |
|------|---------|
| `server/src/utils/scanning.ts` | New file with scanning utilities |
| `server/src/routes/query.ts` | Use scanning utils |
| `server/src/routes/index.ts` | Use scanning utils |
| `server/src/routes/projects.ts` | Use scanning utils |

---

#### Acceptance Criteria

- [ ] Scanning utilities extracted to shared module
- [ ] Routes use shared scanning functions
- [ ] Reduced code duplication across route files

---

### NFR-12: Extract API_URL Config

**Quick win** - Same API URL pattern repeated in every component.

---

#### The Problem

Every component that makes API calls has:
```typescript
const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5101';
```

---

#### Solution

Create `client/src/config.ts`:

```typescript
export const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5101';
export const WS_URL = API_URL.replace(/^http/, 'ws');
// Future: other config values
```

Import everywhere:
```typescript
import { API_URL } from '../config';
```

---

#### Files to Modify

| File | Changes |
|------|---------|
| `client/src/config.ts` | New file |
| All components with API_URL | Import from config |

---

#### Acceptance Criteria

- [ ] Single `config.ts` file with API_URL
- [ ] All components import from config
- [ ] No inline API_URL definitions in components

---

### NFR-1: Dynamic CORS Origins

**As a developer**, I want CORS origins to be configured dynamically rather than hardcoded, so the codebase is easier to maintain when ports change.

**Options:**
- Use `origin: true` in development (reflects requesting origin)
- Use environment variable: `CORS_ORIGINS=http://localhost:5100`
- Configure Vite to proxy API requests (eliminates CORS entirely)

**Current state:** Hardcoded list of ports (5100, 5173, 5174, 5175) in `server/src/index.ts`

---

### NFR-2: Configurable Tags via JSON

**Status:** âš ï¸ NEEDS CLARIFICATION - Global vs Suggested tags

**As a developer**, I want tags to be configured in a JSON config file rather than hardcoded, so they can be easily modified without code changes.

**Key Distinction - Two types of tags:**

1. **Global tags** (`availableTags`) - Always visible in UI, can be applied to ANY segment
   - `CTA` - Call to action (can happen anywhere: intro, mid-roll, outro)
   - `SKOOL` - Skool-specific CTA (can happen anywhere)

2. **Suggested tags** (`suggestTags` on commonNames) - Extra tags that appear/auto-select for specific segment types
   - `ENDCARD` - Only relevant for outros, auto-suggested when "outro" selected

**Proposed config structure:**
```json
{
  "availableTags": ["CTA", "SKOOL"],
  "commonNames": [
    { "name": "intro", "autoSequence": true },
    { "name": "demo" },
    { "name": "summary" },
    { "name": "outro", "suggestTags": ["ENDCARD"] }
  ]
}
```

**UI Behavior:**
- Global tags (CTA, SKOOL) always shown as checkboxes
- When "outro" is selected, ENDCARD appears as additional option (or auto-checks)
- All tags remain available, `suggestTags` just adds/pre-selects extras

**Notes:**
- Tags displayed in UPPERCASE for visual distinction
- Tags are NOT included when merging chapters (chapter names only use the name component)

---

### NFR-3: Configurable Common Names with Rules Engine

**As a developer**, I want common recording names configured in JSON with simple rules, so context-appropriate names are suggested based on current chapter/sequence.

**Proposed location:** `server/config.json` (same file as tags)

**Proposed format:**
```json
{
  "commonNames": [
    { "name": "intro", "minChapter": 1, "maxChapter": 2 },
    { "name": "outro", "minChapter": 4 },
    { "name": "scenario" },
    { "name": "recap", "minChapter": 2 },
    { "name": "demonstration" },
    { "name": "research" },
    { "name": "setup", "maxChapter": 3 },
    { "name": "overview", "maxChapter": 2 },
    { "name": "refactor" }
  ]
}
```

**Rules:**
- `minChapter` - Only show when chapter >= value (e.g., outro after chapter 4)
- `maxChapter` - Only show when chapter <= value (e.g., intro only chapters 1-2)
- No rules = always available

**Analysis of existing recordings in v-appydave:**
| Name | Count | Notes |
|------|-------|-------|
| scenario | 18 | + 5 typos as "senario" |
| intro | 16 | Structural - early chapters only |
| demonstration | 10 | |
| research | 9 | Often as "research-prompt" |
| refactor | 9 | |
| outro | 8 | Structural - later chapters only |
| setup | various | Early chapters |
| overview | 4 | Early chapters |
| recap | 2+ | After initial content |

---

### FR-13: Common Names Quick-Select UI

**As a content creator**, I want to see common names as small pill buttons below the name field, so I can quickly select a name without typing.

**Requirements:**
- Display as small pill/chip buttons below the name input field
- Clicking a pill fills in the name field with that value
- Only show pills that pass the rules engine (based on current chapter)
- Only show pills when sequence = 1 (name is locked after sequence 1)

**UI behavior:**
- Sequence = 1: Name field editable, pill buttons visible
- Sequence > 1: Name field read-only (inherited from sequence 1), no pills shown

**Visual:**
```
Name: [_______________]
[intro] [scenario] [demo] [recap]   <- small pills, only when seq=1
```

---

### FR-14: Recordings Asset View

**As a content creator**, I want a separate page/tab showing all recordings in the current project, so I can see what assets I have without leaving the app.

**Requirements:**
- New page/view accessible via tab or navigation
- Shows files from both `recordings/` and `.safe/` folders
- Groups files by chapter with visual separators
- Chapter separator: thin horizontal line with label in square brackets (e.g., `â€”â€”[ 01 intro ]â€”â€”`)
- Toggle setting to show/hide chapter separators (useful for smaller projects)

**File display:**
- Filename, size, date
- Visual indication of which folder (recordings vs .safe)
- Possibly show "good take" indicators per chapter

**Chapter grouping example:**
```
â€”â€”[ 01 intro ]â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
  01-1-intro.mov     14.1 MB
  01-2-intro.mov     13.6 MB
  01-3-intro.mov     27.5 MB  â˜…
  01-4-intro.mov      8.7 MB

â€”â€”[ 03 scenario ]â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
  03-1-scenario.mov  32.5 MB
  03-2-scenario.mov  20.6 MB
  ...
```

**Navigation:**
- Consider tabs: "Incoming" (current main view) | "Recordings" (this new view)
- Or simple toggle/button in header

---

### FR-15: Move to Safe

**Full specification:** `docs/recording-namer/move-to-safe-spec.md`

**As a content creator**, I want to move completed recordings to a `-safe` folder, so I can focus on the current chapter while keeping finished chapters accessible.

**Mental Model:**
- `recordings/` = "Working on it" (active recording session)
- `recordings/-safe/` = "Done, but still in this session" (out of the way, but accessible)

**Typical Workflow:**
1. Record chapter 01, rename files â†’ they sit in `recordings/`
2. Record chapter 02, rename files â†’ now chapter 01 clutters the view
3. Move all of chapter 01 to `-safe/` â†’ focus on chapter 02
4. Continue until video is complete

**Requirements:**
- Per-file action: `[â†’ Safe]` button on each file row
- Per-chapter action: `[â†’ Safe All]` button on chapter heading
- Moves files from `recordings/` to `recordings/-safe/`
- Preserves filename
- Toast confirmation after move
- Restore action: `[â† Restore]` on safe file rows (when "Show safe" is on)

**Folder structure:**
```
project/
â”œâ”€â”€ -trash/              <- discarded files (sibling to recordings)
â””â”€â”€ recordings/
    â”œâ”€â”€ -safe/           <- completed chapters (inside recordings)
    â”œâ”€â”€ 02-1-demo.mov    <- active working files
    â””â”€â”€ ...
```

**Note:** `-safe` is inside recordings (not a sibling like `-trash`) for easier management.

---

### FR-16: Discard Remaining Files Prompt

**As a content creator**, after renaming a file when other incoming files remain, I want to be prompted to discard them, so I don't have to manually click Discard on each one.

**Trigger:**
- After a successful rename
- When there are still 1+ files remaining in the incoming list

**UI:**
- Simple modal dialog appears after rename completes
- Message: "Discard remaining X file(s)?" (or similar)
- Two buttons: "Yes" / "No"
- Yes: Trash all remaining files (same as clicking Discard on each)
- No: Dismiss modal, leave files in list

**Example flow:**
1. User has 4 incoming files
2. User renames file #3 (the good take)
3. Modal appears: "Discard remaining 3 files?"
4. User clicks "Yes"
5. Files 1, 2, 4 are moved to `.trash/`

**Technical notes:**
- First modal dialog in the app - may need to add a modal component/library
- Consider using existing toast library (sonner) or simple custom modal
- Keep it lightweight - no need for a heavy modal framework

---

### FR-17, FR-18, FR-19: Image Asset Management

**Full specification:** `docs/recording-namer/image-asset-management-spec.md`

**FR-17: Image Asset Management Page**
- New "Assets" page for assigning images from Downloads to project
- Scan `~/Downloads` for incoming images (png, jpg, webp)
- Thumbnail grid display
- Assignment controls: chapter, sequence, image order, label
- Move and rename to `assets/images/` folder

**FR-18: Image Duplicate Detection**
- Detect duplicate images by file hash (MD5)
- Show warning when duplicates found
- Auto-hide or badge duplicates in grid

**FR-19: Image Variant Support (A/B/C)**
- Optional variant letter (a-z) in filename
- For A/B testing alternatives for video editor
- Example: `05-3-2a-workflow.png`, `05-3-2b-workflow.png`

**Naming convention:**
```
{chapter}-{seq}-{imgOrder}{variant}-{label}.{ext}
Example: 05-3-1a-workflow-diagram.png
```

---

### NFR-4: Rename "Subsequence" to "Sequence"

**As a content creator**, I want the field called "sequence" (or "SEQ") instead of "subsequence", for clearer terminology.

**Changes required:**
- UI labels: "Subsequence" â†’ "Sequence" (or "Seq")
- Variable names: `subsequence` â†’ `sequence`
- API/types: Update `RenameRequest`, `SuggestedNaming`, etc.

**Note:** Chapter stays as-is. Only the sub-numbering field changes.

---

### NFR-7: Show Recording Duration

**As a content creator**, I want to see the duration of each incoming recording, so I can quickly identify short junk takes vs substantial recordings.

**Current display:**
```
Movie on 2025-12-01 at 14.32.mov    14.1 MB    Dec 1, 14:32
```

**Proposed display:**
```
Movie on 2025-12-01 at 14.32.mov    2:34    14.1 MB    Dec 1, 14:32
```

**Duration format:**
- Under 1 minute: `0:45` (seconds)
- 1-59 minutes: `2:34` (min:sec)
- 60+ minutes: `1:02:34` (hr:min:sec)

**Technical approach:**

Use `ffprobe` (part of ffmpeg) to extract duration:

```bash
ffprobe -v quiet -show_entries format=duration -of csv=p=0 "file.mov"
# Returns: 154.234 (seconds as float)
```

**Backend:**
```typescript
import { exec } from 'child_process';

function getVideoDuration(filePath: string): Promise<number | null> {
  return new Promise((resolve) => {
    exec(
      `ffprobe -v quiet -show_entries format=duration -of csv=p=0 "${filePath}"`,
      (error, stdout) => {
        if (error) return resolve(null);
        const seconds = parseFloat(stdout.trim());
        resolve(isNaN(seconds) ? null : seconds);
      }
    );
  });
}
```

**Utility function:**
```typescript
// shared/formatting.ts or client/src/utils/formatting.ts
export function formatDuration(seconds: number): string {
  const hrs = Math.floor(seconds / 3600);
  const mins = Math.floor((seconds % 3600) / 60);
  const secs = Math.floor(seconds % 60);

  if (hrs > 0) {
    return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}
```

**API change:**

Add `duration` field to file response:
```typescript
interface IncomingFile {
  filename: string;
  size: number;
  mtime: string;
  duration?: number;  // seconds, null if unavailable
}
```

**Prerequisite:**
- `ffprobe` must be installed (`brew install ffmpeg`)
- If not available, duration shows as `-` or is omitted

**UI placement:**
- After filename, before file size
- Slightly muted color (like the timestamp)

---

### NFR-6: Codebase Refactor

**Purpose:** Consolidate patterns, fix architectural issues, and establish consistency across the codebase after rapid feature development.

---

#### 1. Shared Components Library

Create `client/src/components/shared/` with extracted components:

| Component | Currently Used In | Notes |
|-----------|-------------------|-------|
| `<SizeToggle />` | AssetsPage, ThumbsPage | S/M/L/XL buttons with localStorage persistence |
| `<HoverPreview />` | AssetsPage (images, prompts), ThumbsPage | Shift+Hover large preview pattern |
| `<OpenFolderButton />` | Config, Incoming, Recordings, Assets, Thumbs | Already exists, move to shared/ |
| `<SectionHeader />` | All pages | Consistent heading with optional icon buttons |
| `<DeleteButton />` | Thumbs, ZIPs, potentially others | Delete with confirmation pattern |

**Acceptance criteria:**
- [ ] `components/shared/` directory exists
- [ ] Each component has consistent props interface
- [ ] All pages updated to use shared components
- [ ] No duplicate component code remains

---

#### 2. Fix Target Directory Config

**Problem:** `targetDirectory` currently points to `recordings/` folder, but the true project root is the parent. This makes derived paths unnecessarily complex.

**Current (wrong):**
```
targetDirectory: ~/dev/video-projects/v-appydave/b64-project/recordings
                                                            â†‘ pointing here

Derived paths require going UP:
- assets/images = path.join(targetDirectory, '..', 'assets', 'images')
- assets/thumbs = path.join(targetDirectory, '..', 'assets', 'thumbs')
- -trash = path.join(targetDirectory, '..', '-trash')
```

**Proposed (correct):**
```
projectDirectory: ~/dev/video-projects/v-appydave/b64-project
                                                  â†‘ pointing here

Derived paths go DOWN:
- recordings = path.join(projectDirectory, 'recordings')
- assets/images = path.join(projectDirectory, 'assets', 'images')
- assets/thumbs = path.join(projectDirectory, 'assets', 'thumbs')
- -trash = path.join(projectDirectory, '-trash')
- -safe = path.join(projectDirectory, 'recordings', '-safe')
```

**Changes required:**
- [ ] Rename config key: `targetDirectory` â†’ `projectDirectory`
- [ ] Update Config UI label: "Target Project Directory" (already correct!)
- [ ] Create `getProjectPaths(projectDirectory)` utility (see below)
- [ ] Update all path derivations to use the utility
- [ ] Migration: existing configs need path adjusted (strip `/recordings`)

---

#### 3. Centralize Path Derivation

Create `shared/paths.ts` (used by both client and server):

```typescript
export interface ProjectPaths {
  project: string;      // ~/dev/video-projects/v-appydave/b64-project
  recordings: string;   // .../recordings
  safe: string;         // .../recordings/-safe
  trash: string;        // .../-trash
  assets: string;       // .../assets
  images: string;       // .../assets/images
  thumbs: string;       // .../assets/thumbs
}

export function getProjectPaths(projectDirectory: string): ProjectPaths {
  return {
    project: projectDirectory,
    recordings: path.join(projectDirectory, 'recordings'),
    safe: path.join(projectDirectory, 'recordings', '-safe'),
    trash: path.join(projectDirectory, '-trash'),
    assets: path.join(projectDirectory, 'assets'),
    images: path.join(projectDirectory, 'assets', 'images'),
    thumbs: path.join(projectDirectory, 'assets', 'thumbs'),
  };
}
```

**Acceptance criteria:**
- [ ] Single source of truth for all project paths
- [ ] No hardcoded path segments scattered in routes
- [ ] `open-folder` endpoint uses this utility
- [ ] All file operations use this utility

---

#### 4. Centralize Watcher Management

Create `server/src/watchers/WatcherManager.ts`:

```typescript
class WatcherManager {
  private watchers: Map<string, chokidar.FSWatcher> = new Map();

  setupProjectWatchers(projectPaths: ProjectPaths) {
    this.closeAll();
    this.watch('recordings', projectPaths.recordings, ...);
    this.watch('safe', projectPaths.safe, ...);
    this.watch('images', projectPaths.images, ...);
    this.watch('thumbs', projectPaths.thumbs, ...);
  }

  setupGlobalWatchers(config: Config) {
    this.watch('ecamm', config.watchDirectory, ...);
    this.watch('downloads', config.imageSourceDirectory, ...);
  }

  closeAll() { ... }
  close(name: string) { ... }
}
```

**Acceptance criteria:**
- [ ] All watchers managed through single class
- [ ] Proper cleanup on project switch
- [ ] Clear distinction: global watchers vs project-specific watchers
- [ ] Logging for watcher setup/teardown

---

#### 5. Centralize Query Keys

Create/update `client/src/constants/queryKeys.ts`:

```typescript
export const queryKeys = {
  // Global
  config: ['config'] as const,
  projects: ['projects'] as const,

  // Incoming (global watch directories)
  incomingFiles: ['incomingFiles'] as const,
  incomingImages: ['incomingImages'] as const,
  zips: ['zips'] as const,

  // Project-specific
  recordings: ['recordings'] as const,
  projectImages: ['projectImages'] as const,
  thumbs: ['thumbs'] as const,
} as const;
```

**Socket invalidation pattern:**

```typescript
// In useSocket or dedicated hook
socket.on('recordings:changed', () => {
  queryClient.invalidateQueries({ queryKey: queryKeys.recordings });
});

socket.on('thumbs:changed', () => {
  queryClient.invalidateQueries({ queryKey: queryKeys.thumbs });
});
```

**Acceptance criteria:**
- [ ] All query keys defined in one file
- [ ] All `useQuery` calls reference `queryKeys.xxx`
- [ ] Socket event handlers use same keys for invalidation
- [ ] No inline string keys anywhere

---

#### 6. Consistent Page Layout & Headers

Establish consistent page structure across all pages:

```tsx
// Standard page template
<div className="page">
  <SectionHeader
    title="INCOMING FILES"
    subtitle="(~/Movies/Ecamm Live Recordings)"
    actions={<OpenFolderButton folder="ecamm" />}
  />

  <div className="page-content">
    {/* page-specific content */}
  </div>
</div>
```

**Audit each page:**

| Page | Has SectionHeader? | Consistent styling? | Actions aligned? |
|------|-------------------|---------------------|------------------|
| Incoming | ? | ? | ? |
| Recordings | ? | ? | ? |
| Assets | ? | ? | ? |
| Thumbs | ? | ? | ? |
| Projects | ? | ? | ? |
| Config | ? | ? | ? |

**Acceptance criteria:**
- [ ] All pages use `<SectionHeader />` component
- [ ] Consistent heading hierarchy (h1, h2, etc.)
- [ ] Action buttons (ğŸ“, refresh, etc.) positioned consistently
- [ ] Spacing/padding consistent across pages

---

#### 7. Consistent Error Handling (Routes)

Audit and standardize error handling across all route files:

**Standard response format:**
```typescript
// Success
res.json({ success: true, data: { ... } });

// Error
res.status(4xx).json({ success: false, error: 'Human-readable message' });
```

**Middleware pattern:**
```typescript
// server/src/middleware/errorHandler.ts
export function asyncHandler(fn: RequestHandler) {
  return (req, res, next) => {
    Promise.resolve(fn(req, res, next)).catch(next);
  };
}

export function errorHandler(err, req, res, next) {
  console.error(err);
  res.status(500).json({ success: false, error: err.message });
}
```

**Acceptance criteria:**
- [ ] All routes use consistent response format
- [ ] Async errors caught properly
- [ ] Client-side error handling consistent (toast on error)

---

#### 8. System Routes Pattern

Establish `/api/system/` as the pattern for non-CRUD operations:

**Current:**
- `POST /api/system/open-folder`

**Future candidates:**
- `POST /api/system/open-file` - open file in default app
- `POST /api/system/reveal-file` - reveal specific file in Finder
- `POST /api/system/transcribe` - transcription service (future)
- `GET /api/system/health` - server health check

**Acceptance criteria:**
- [ ] Document the `/api/system/` pattern
- [ ] Security considerations documented (local-only, no arbitrary paths)

---

### Refactor Checklist Summary

| Area | Priority | Effort |
|------|----------|--------|
| Fix target directory â†’ project directory | High | Medium |
| Centralize path derivation | High | Low |
| Shared components library | High | Medium |
| Centralize query keys | Medium | Low |
| Centralize watcher management | Medium | Medium |
| Consistent page layout | Medium | Medium |
| Consistent error handling | Low | Low |
| Document system routes pattern | Low | Low |

---

### Implementation Plan: 3 Commits

#### Commit 1: Quick Wins (NFR-6a)

**Items:** #5, #7, #8

| Task | Description |
|------|-------------|
| Centralize Query Keys | Move all inline query key strings to `client/src/constants/queryKeys.ts`. Update all `useQuery`/`useMutation` calls to reference the constants. |
| Consistent Error Handling | Audit routes for consistent `{ success, data/error }` response format. Add `asyncHandler` wrapper if missing. |
| Document System Routes | Add comments/docs for `/api/system/` pattern and security considerations. |

**Risk:** Low - no behavior change, just organization.

---

#### Commit 2: Path Architecture (NFR-6b)

**Items:** #2, #3

| Task | Description |
|------|-------------|
| Fix targetDirectory â†’ projectDirectory | Rename config key. Update Config UI. Add migration to strip `/recordings` from existing configs on load. |
| Centralize Path Derivation | Ensure `shared/paths.ts` has `getProjectPaths()` returning all derived paths. Update all routes to use it. Remove scattered `path.join(..., '..', ...)` calls. |

**Risk:** Medium-High - breaking change to config structure. Test thoroughly:
- Project switching still works
- All file operations go to correct folders
- Config migration handles existing setups

---

#### Commit 3: UI Consistency (NFR-6c)

**Items:** #1, #4, #6

| Task | Description |
|------|-------------|
| Shared Components Library | Extract `SizeToggle`, `HoverPreview`, `SectionHeader`, `DeleteButton` to `client/src/components/shared/`. Update all pages to use them. |
| Centralize Watcher Management | Create `WatcherManager` class. Move all chokidar setup into it. Clear separation of global vs project watchers. |
| Consistent Page Layout | Audit all pages for consistent `SectionHeader` usage, heading hierarchy, action button placement. |

**Risk:** Low - refactoring with no behavior change.

---

### NFR-5: Extend Socket Infrastructure for Real-Time Updates

**As a content creator**, I want all pages to update in real-time when files change on disk, so I don't have to manually refresh or navigate away to see changes.

**Context:**

The app has a working Socket.io system for the Incoming recordings feature:
- Server emits `file:new`, `file:deleted` when recordings appear/disappear
- Client listens and updates UI in real-time with toast notifications
- Typed events in `shared/types.ts` (`ServerToClientEvents`)

However, newer features use polling or require manual refresh:

| Feature | Current Method | User Impact |
|---------|----------------|-------------|
| FR-27: Thumbs - ZIP list | Polling (5s) | Delayed updates when downloading ZIPs |
| FR-27: Thumbs - Current thumbnails | Polling (3s) | Delayed updates after import |
| FR-17: Assets - Incoming images | No refresh | Must manually refresh or navigate away |
| FR-17: Assets - Assigned images | No refresh | Must manually refresh after assign |
| FR-14: Recordings view | No refresh | Must manually refresh after rename |
| FR-10: Projects list | No refresh | Must manually refresh after project changes |

**Proposed Solution:**

Extend the socket system with new events:

```typescript
// In shared/types.ts ServerToClientEvents
'thumbs:changed': () => void;           // Thumb imported/deleted/reordered
'thumbs:zip-added': () => void;         // New ZIP detected in Downloads
'assets:incoming-changed': () => void;  // New image in source directory
'assets:assigned-changed': () => void;  // Image assigned to project
'recordings:changed': () => void;       // Recording renamed/moved
'projects:changed': () => void;         // Project list changed
```

**Implementation Notes:**

1. **File watchers (chokidar):**
   - Already set up for recordings directory
   - Add watchers for: Downloads (ZIPs), `assets/thumbs/`, `assets/images/`, `imageSourceDirectory`
   - Project-specific folders (`thumbs`, `images`) need watcher recreation on project switch (already handled for recordings)

2. **Client-side:**
   - Listen for socket events
   - Invalidate React Query cache to trigger refetch
   - Simple pattern: socket event â†’ `queryClient.invalidateQueries(['thumbs'])`

3. **Effort estimate:**
   - ~50-100 lines server-side for watchers + event emission
   - ~20-30 lines client-side per feature for event listeners
   - Can be implemented incrementally per feature

**Priority:**
- FR-27 (Thumbs) has active polling that should be replaced first
- Other features can be addressed as time permits

---

### FR-29: Open Folder in Finder

**As a content creator**, I want to quickly open key folders in Finder from various places in the app, so I can access files directly without manually navigating.

**Folders to support:**

| Folder | Config Key | Example Path |
|--------|------------|--------------|
| Ecamm Watch | `watchDirectory` | `~/Movies/Ecamm Live Recordings` |
| Downloads | `imageSourceDirectory` | `~/Downloads` |
| Recordings | `targetDirectory` | `~/dev/video-projects/v-appydave/b64-.../recordings` |
| Images | derived | `{targetDirectory}/../assets/images` |
| Thumbnails | derived | `{targetDirectory}/../assets/thumbs` |
| Trash | derived | `{targetDirectory}/../-trash` |
| Safe | derived | `{targetDirectory}/-safe` |

**UI - Folder icon button:**

Small folder icon (ğŸ“) next to folder references throughout the app:

```
Config page:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ecamm Watch Directory:  [~/Movies/Ecamm Live Recordings] [ğŸ“]  â”‚
â”‚  Target Directory:       [~/dev/video-projects/.../recordings] [ğŸ“]  â”‚
â”‚  Image Source Directory: [~/Downloads] [ğŸ“]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Incoming page header:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INCOMING FILES (~/Movies/Ecamm Live Recordings)  [ğŸ“]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Recordings page header:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RECORDINGS (recordings/)  [ğŸ“]    SAFE (-safe/)  [ğŸ“]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Assets page:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INCOMING IMAGES (~/Downloads)  [ğŸ“]                            â”‚
â”‚  ASSIGNED ASSETS (assets/images/)  [ğŸ“]                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Thumbs page:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IMPORT FROM ZIP (~/Downloads)  [ğŸ“]                            â”‚
â”‚  THUMBNAILS (assets/thumbs/)  [ğŸ“]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Locations summary:**

| Page | Folders Available |
|------|-------------------|
| Config | Ecamm Watch, Target (Recordings), Image Source (Downloads) |
| Incoming | Ecamm Watch |
| Recordings | Recordings, Safe |
| Assets | Downloads (incoming), Images (assigned) |
| Thumbs | Downloads (ZIPs), Thumbnails |
| Projects | (optional) Project root folder |

**API:**

```
POST /api/system/open-folder
{
  "folder": "recordings" | "safe" | "trash" | "images" | "thumbs" | "downloads" | "ecamm"
}
```

**Backend implementation:**

```typescript
import { exec } from 'child_process';

// macOS only - use 'open' command
exec(`open "${expandedPath}"`, (error) => {
  if (error) {
    return res.status(500).json({ success: false, error: 'Failed to open folder' });
  }
  res.json({ success: true });
});
```

**Security considerations:**
- Only allow predefined folder keys (not arbitrary paths)
- Validate folder exists before opening
- Log folder open requests

**Technical notes:**
- macOS: `open /path/to/folder`
- Windows (future): `explorer /path/to/folder`
- Linux (future): `xdg-open /path/to/folder`
- For now, macOS only is fine (local dev tool)

---

### FR-28: Server Connection Indicator

**As a content creator**, I want to see at a glance whether the app is connected to the server, so I know if real-time updates are working.

**Requirements:**
- Unobtrusive indicator - visible but not attention-grabbing
- Shows connection state: connected / disconnected / reconnecting
- Does NOT go in the main navigation bar

**Suggested placement options:**

1. **Footer corner** (recommended)
   - Small dot or icon in bottom-right corner
   - Green = connected, Red = disconnected, Yellow = reconnecting
   - Tooltip on hover: "Connected to server" / "Disconnected - reconnecting..."

2. **Header right edge**
   - Tiny dot next to the rightmost nav item
   - Same color coding

**Visual design:**

```
Footer approach:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Incoming] [Recordings] [Assets] [Thumbs] [Projects] [Config]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚                        (page content)                            â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  b64-awesome-video                                          ğŸŸ¢  â”‚
â”‚  â””â”€ current project                               â””â”€ connected  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**States:**

| State | Color | Tooltip | When |
|-------|-------|---------|------|
| Connected | ğŸŸ¢ Green | "Connected" | Socket connected, real-time updates active |
| Disconnected | ğŸ”´ Red | "Disconnected" | Socket lost, no real-time updates |
| Reconnecting | ğŸŸ¡ Yellow | "Reconnecting..." | Attempting to reconnect |

**Behavior:**
- On disconnect: indicator turns red, app continues to work (API calls still function)
- On reconnect: indicator turns green, toast notification: "Reconnected"
- No modal or blocking UI - just visual feedback

**Technical notes:**
- Use socket connection state from `useSocket` hook
- Socket.io provides `connect`, `disconnect`, `reconnect` events
- Consider adding `reconnect_attempt` for the yellow state

---

### FR-20: Image Quick Preview (Shift+Hover)

**As a content creator**, I want to quickly preview images at a larger size by holding Shift and hovering over thumbnails, so I can inspect image details without clicking through to a modal.

**Applies to:**
- Incoming images grid (Assets page)
- Assigned images list (Assets page)

**Interaction:**
1. Hold Shift key
2. Hover over any image thumbnail
3. Large preview appears as tooltip-style overlay near the cursor
4. Release Shift OR move mouse away â†’ preview disappears instantly

**Preview content:**
- Large image (~600px)
- Filename
- File size
- Timestamp

**Behavior:**
- Preview appears instantly (no delay)
- Preview positions itself to stay within viewport (below/beside thumbnail)
- Preview follows which thumbnail is hovered while Shift is held
- Works on both incoming and assigned image grids

**Mockup:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INCOMING IMAGES                                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ img1 â”‚ â”‚ img2 â”‚ â”‚ img3 â”‚ â”‚ img4 â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                 â†‘                                            â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚           â”‚                         â”‚                        â”‚
â”‚           â”‚                         â”‚                        â”‚
â”‚           â”‚    [LARGE PREVIEW]      â”‚                        â”‚
â”‚           â”‚       ~600px            â”‚                        â”‚
â”‚           â”‚                         â”‚                        â”‚
â”‚           â”‚                         â”‚                        â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚           â”‚ workflow-diagram.png    â”‚                        â”‚
â”‚           â”‚ 3.1 MB Â· Nov 29, 10:22  â”‚                        â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Technical notes:**
- Track Shift key state globally via keydown/keyup events
- Use React state to track which image is being previewed
- Position preview using mouse coordinates, clamped to viewport
- Consider using a portal to render preview at document root (avoids z-index issues)

---

### FR-33: Final Video & SRT Reference

**As a content creator**, I want Recording Namer to know where my final video and SRT files are, so downstream features (chapter extraction, timing reconciliation) can access them automatically.

---

#### Context

After recording, there are multiple video processing stages:

| Stage | Who | Tool | Output |
|-------|-----|------|--------|
| Recording | David | Ecamm Live | Raw recordings (`recordings/`) |
| Transcription | David | Whisper | Raw transcripts (`recording-transcripts/`) |
| Edit Pass 1 | David | Gling.AI | Edited video + SRT |
| Edit Pass 2 | Jan | DaVinci Resolve | Polished video (versioned) |
| Publishing | David | YouTube | Final published version |

**The gap:** Recording Namer currently has no reference to the "final" video or SRT. This prevents:
- Automatic chapter timestamp extraction (matching chapter names to SRT)
- Asset placement timing hints for editor
- YouTube description generation with accurate timestamps

---

#### Current Folder Analysis

From analysis of 13 projects (b59-b75):

**Where final videos end up (inconsistent):**

| Pattern | Frequency | Example |
|---------|-----------|---------|
| `final/{code}.mp4` | 2 projects | `final/b64-bmad-claude-sdk.mp4` |
| `s3-staging/{code}-final-v*.mp4` | 9 projects | `s3-staging/b64-final-v4.mp4` |
| Project root `{code}.mp4` | 2 projects | `b71-context-engineering.mp4` |
| Project root `*.srt` | 4 projects | `b71-context-engineering.srt` |

**The `final/` folder pattern (b64):**
```
final/
â”œâ”€â”€ b64-bmad-claude-sdk.mp4      (4.4 GB - THE final)
â”œâ”€â”€ b64-bmad-claude-sdk.mp4.txt  (transcript)
â””â”€â”€ b64-bmad-claude-sdk.srt      (timing source of truth)
```

**The `s3-staging/` folder pattern:**

This is the DAM exchange point between David and Jan:

*Outbound (David â†’ Jan):*
- Gling.AI exports: `{code}.mp4`, `{code}.srt`
- Additional segments: `{descriptive-name}.mp4` (when extra footage needed)

*Inbound (Jan â†’ David):*
- Versioned finals: `{code}-final.mp4`, `{code}-final-v1.mp4`, `{code}-final-v2.mp4`, etc.

---

#### Requirements

**1. Auto-detect final video and SRT**

Scan project folders in priority order:

```
Final Video detection priority:
1. final/{project-code}*.mp4          (preferred - explicit final folder)
2. s3-staging/{code}-final-v*.mp4     (latest version number)
3. s3-staging/{code}.mp4              (Gling export, no Jan version)
4. {project-root}/{code}*.mp4         (fallback - project root)

Final SRT detection priority:
1. final/{project-code}*.srt
2. s3-staging/{project-code}*.srt
3. {project-root}/{project-code}*.srt
```

**Version detection:**
- For patterns like `b64-final-v4.mp4`, extract version number
- Select highest version as "latest"
- If no version number, treat as v0

---

**2. Display in Projects panel (â“˜ popup)**

Add to existing stats popup (FR-32):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  b64-bmad-claude-sdk    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Created:    Nov 28     â”‚
â”‚  Last edit:  3 days ago â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Final Video: âœ… 4.4 GB â”‚  â† NEW
â”‚  Final SRT:   âœ…        â”‚  â† NEW
â”‚  Location:   final/     â”‚  â† NEW (or s3-staging/ or root)
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Recordings: 12         â”‚
â”‚  Safe:       3          â”‚
â”‚  Transcripts:12/15 (80%)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**States:**
- `âœ…` = File found
- `âŒ` = Not found
- `âš ï¸ v3` = Multiple versions, showing v3 (latest)

---

**3. API endpoint**

```
GET /api/projects/:code/final
```

**Response:**
```typescript
interface FinalMediaResponse {
  success: boolean;
  video?: {
    path: string;           // Absolute path
    filename: string;       // Just the filename
    size: number;           // Bytes
    version?: number;       // Extracted version number (1, 2, 3...)
    location: 'final' | 's3-staging' | 'root';
  };
  srt?: {
    path: string;
    filename: string;
    size: number;
    location: 'final' | 's3-staging' | 'root';
  };
  additionalSegments?: {    // For multiple Gling exports
    filename: string;
    size: number;
    hasSrt: boolean;
  }[];
}
```

---

**4. Handle multiple Gling exports**

Gling.AI cannot import additional footage after starting edits. When David needs more content:
- Export main video: `b64-bmad-claude-sdk.mp4`
- Export additional segments: `b64-outro.mp4`, `talking-head.mp4`

**Display:**
- Primary video shown as "Final Video"
- Additional segments listed separately: "+ 3 additional segments"
- Each segment may have its own SRT

---

**5. Open final folder button**

Add to FR-29 (Open Folder in Finder):

| Page | Location | Opens |
|------|----------|-------|
| Projects | Stats popup (â“˜) | `final/` folder (or s3-staging if no final/) |

---

#### Future Considerations (Out of Scope)

These are documented for future FR-34/FR-35:

1. **Standardize `final/` folder** - Prompt user to move files to `final/` when found elsewhere
2. **Chapter timestamp extraction** - Use final SRT to generate YouTube chapter list
3. **Timing reconciliation** - Match recording-time notes to final video timestamps
4. **Jan version naming tool** - Generate next version filename for Jan
5. **Disk space cleanup** - Archive old versions after project complete

---

#### UI Mockup - Projects Panel (Updated)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AppyDave Projects (13 projects)                                      [+ New]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚ Project Code                    â”‚ Stage â”‚ Ch â”‚ Files â”‚  ğŸ“„   â”‚ ğŸ¬ â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Œ â”‚   b72-flivideo-recording-demo   â”‚ EDIT  â”‚ 12 â”‚    28 â”‚ 100%  â”‚ âœ… â”‚ â“˜        â”‚
â”‚  ğŸ“Œ â”‚   b74-multi-agent-workflows     â”‚  REC  â”‚  4 â”‚     8 â”‚   0%  â”‚ âŒ â”‚ â“˜        â”‚
â”‚     â”‚   b64-bmad-claude-sdk           â”‚ DONE  â”‚ 87 â”‚    87 â”‚ 100%  â”‚ âœ… â”‚ â“˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**New column: ğŸ¬ (Final)**
- `âœ…` = Final video found
- `âŒ` = No final video yet
- Clicking â“˜ shows full details (path, size, version, SRT status)

---

#### Technical Notes

**Detection algorithm:**

```typescript
async function detectFinalMedia(projectPath: string, projectCode: string): Promise<FinalMediaResponse> {
  const locations = ['final', 's3-staging', ''];  // '' = project root

  for (const loc of locations) {
    const searchPath = loc ? path.join(projectPath, loc) : projectPath;

    // Look for video files matching project code
    const videos = await glob(`${searchPath}/${projectCode}*.mp4`);
    const srts = await glob(`${searchPath}/${projectCode}*.srt`);

    if (videos.length > 0) {
      // Find latest version
      const latestVideo = findLatestVersion(videos);
      const matchingSrt = findMatchingSrt(latestVideo, srts);

      return {
        success: true,
        video: {
          path: latestVideo.path,
          filename: path.basename(latestVideo.path),
          size: latestVideo.size,
          version: latestVideo.version,
          location: loc || 'root',
        },
        srt: matchingSrt ? { /* ... */ } : undefined,
      };
    }
  }

  return { success: true };  // No final video found (yet)
}

function findLatestVersion(videos: string[]): { path: string; version?: number } {
  // Extract version numbers: b64-final-v3.mp4 â†’ 3
  // Return highest version, or first if no versions
}
```

**Version regex:**
```typescript
const versionMatch = filename.match(/-v(\d+)\.[^.]+$/);
const version = versionMatch ? parseInt(versionMatch[1], 10) : undefined;
```

---

#### Acceptance Criteria

- [ ] API endpoint returns final video/SRT info for a project
- [ ] Auto-detection follows priority order: final/ â†’ s3-staging/ â†’ root
- [ ] Version detection finds latest when multiple versions exist
- [ ] Projects panel â“˜ popup shows final video status
- [ ] Additional Gling segments detected and listed
- [ ] Open folder button opens final/ folder (or fallback location)
- [ ] Projects without final videos show `âŒ` gracefully

---

### FR-34: Chapter Timestamp Extraction

**As a content creator**, I want to generate YouTube chapter timestamps from my final video's SRT file, so I can quickly create chapter markers for my video description.

---

#### The Goal

Generate output like this:

```
00:00 Intro
02:34 Setting up the Project
05:12 First Implementation
08:45 Testing and Debugging
12:30 Final Demo
15:22 Outro
```

Copy to clipboard, paste into YouTube description.

---

#### Input Data Available

| Source | Data | Example |
|--------|------|---------|
| Recording filenames | Chapter names | `01-intro`, `02-scenario`, `03-setup-bmad` |
| Final SRT (from FR-33) | Timestamped text | `00:02:34,500 --> 00:02:38,200` |
| Recording transcripts | Raw chapter text | `recording-transcripts/01-1-intro.txt` |

---

#### The Matching Problem

**Easy case:** Chapter name appears literally in SRT
- Recording: `03-setup-bmad.mov`
- First words of chapter: "Let's set up BMAD"
- Find in SRT â†’ extract timestamp

**Harder case:** Edited/rephrased content
- Recording transcript: "Um, so let's uh set up BMAD now"
- Final SRT: "Let's set up BMAD now"
- Need fuzzy matching

---

#### Requirements

**1. Parse final SRT**
- Read SRT file detected by FR-33
- Extract all timestamped segments

**2. Get chapter list**
- Scan recording filenames OR recording-transcripts folder
- Extract unique chapter numbers and names: `01-intro`, `02-scenario`, etc.

**3. Match chapters to SRT timestamps**
- For each chapter, find where it starts in the SRT
- Return timestamp with confidence level

**4. Generate YouTube chapter format**
- Format: `MM:SS Title` or `HH:MM:SS Title` for longer videos
- Title derived from chapter name (intro â†’ Intro, setup-bmad â†’ Setting up BMAD)

**5. UI: Copy to clipboard**
- Button in Projects panel or new Chapters section
- One click â†’ formatted chapter list in clipboard
- Toast confirmation

---

#### Accuracy Target

- **90%+ correct** on first pass for typical videos
- Low-confidence matches flagged for manual review
- User can edit before copying

---

#### Implementation Approach - Developer's Choice

The matching step can be implemented multiple ways. Developer should evaluate:

**Option A: Algorithmic**
- Longest common subsequence
- First N words of each chapter â†’ search in SRT
- Fast, free, deterministic
- May fail on heavily edited content

**Option B: LLM-Assisted**
- Use Claude to match chapter text to SRT segments
- More robust for fuzzy matching
- Reference: `~/dev/ad/appydave-app-a-day/007-bmad-claude-sdk/docs/claude-agent-sdk-reference.md`
- This doc shows how to make simple LLM calls from the server

**Option C: Hybrid**
- Try algorithmic first
- Fall back to LLM for low-confidence matches
- Best of both: fast when easy, robust when hard

**Recommendation:** Start with Option A to see how far it gets. Add LLM if accuracy is below target.

---

#### UI Mockup

**Option 1: In ProjectStatsPopup**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  b64-bmad-claude-sdk    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Final Video: âœ… 4.4 GB â”‚
â”‚  Final SRT:   âœ…        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Chapters: 12 detected  â”‚
â”‚  [ğŸ“‹ Copy Chapters]     â”‚  â† Button
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Option 2: Dedicated Chapters Panel**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CHAPTERS (b64-bmad-claude-sdk)                    [ğŸ“‹ Copy All] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… 00:00   Intro                                               â”‚
â”‚  âœ… 02:34   Setting up BMAD                                     â”‚
â”‚  âš ï¸ 05:12   First Implementation        [confidence: 72%]       â”‚
â”‚  âœ… 08:45   Testing                                             â”‚
â”‚  âŒ ???     Debugging                   [not found]             â”‚
â”‚  âœ… 12:30   Final Demo                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Status indicators:
- âœ… High confidence match
- âš ï¸ Low confidence (may need manual check)
- âŒ Not found in SRT

---

#### API

```
GET /api/projects/:code/chapters
```

**Response:**
```typescript
interface ChapterMatch {
  chapter: number;           // 1, 2, 3...
  name: string;              // "intro", "setup-bmad"
  displayName: string;       // "Intro", "Setting up BMAD"
  timestamp?: string;        // "02:34" or null if not found
  timestampSeconds?: number; // 154
  confidence: number;        // 0-100
  status: 'matched' | 'low_confidence' | 'not_found';
}

interface ChaptersResponse {
  success: boolean;
  chapters: ChapterMatch[];
  formatted: string;         // Ready-to-copy YouTube format
}
```

---

#### Edge Cases

| Case | Handling |
|------|----------|
| No SRT file | Show message: "No SRT file found" |
| No recordings | Show message: "No chapters detected" |
| Chapter not in SRT | Mark as `not_found`, exclude from output |
| Multiple matches | Take first match (chapters are sequential) |
| Very short chapter | May have been cut entirely - mark `not_found` |

---

#### Out of Scope (Future)

- Manual timestamp editing in UI
- Re-running match with different algorithm
- Saving/caching chapter data
- Segment-level timing (asset placement hints)

---

#### Reference Materials

**Claude Agent SDK (for LLM option):**
- Location: `~/dev/ad/appydave-app-a-day/007-bmad-claude-sdk/docs/claude-agent-sdk-reference.md`
- Shows stateless pattern (~12 lines) for simple LLM calls
- Uses `claude-haiku-4-5` for fast/cheap operations
- Already proven to work in David's codebase

**SRT Format:**
```
1
00:00:02,500 --> 00:00:05,200
Welcome to this tutorial on BMAD.

2
00:00:05,400 --> 00:00:08,100
Today we're going to set up the project.
```

---

#### Acceptance Criteria

**Phase 1 (MVP) - âœ… Complete:**
- [x] Parse SRT file from FR-33 detection
- [x] Extract chapter list from recordings/transcripts
- [x] Match chapters to SRT with confidence scoring
- [x] Generate YouTube-format chapter list
- [x] Copy to clipboard button works
- [x] Low-confidence matches visually flagged

**Phase 2+ - See spec file for details:**
- [ ] UI improvements (3-state colors, match explanations)
- [ ] Algorithm improvements (proper text similarity library)
- [ ] LLM fallback for semantic matching

---

#### Detailed Spec

**See:** `chapter-extraction-spec.md`

The spec file contains:
- Implementation phases with acceptance criteria
- Algorithm documentation with diagrams
- Known issues discovered during b64 testing
- Files to modify for each phase

---

### FR-35: Fix Chapter Grouping Logic

**Bug:** Recordings page shows duplicate chapter headings when filenames within the same chapter have slight name variations.

---

#### The Problem

**Current behavior:** Groups by chapter number + name. Different names = different groups.

**Example from b64:**

```
08 Voz Boy Baker.mov (1 file)      â† 08-1-voz-boy-baker.mov.mov (note: .mov in name!)
08 Voz Boy Baker (1 file)          â† 08-2-voz-boy-baker.mov

11 Architect Architecture (1 file)           â† 11-1-architect-architecture.mov
11 Architect Architecture Full Review (1 file) â† 11-2-architect-architecture-full-review.mov

20 Claude Sdk Configuration (1 file)              â† 20-1-claude-sdk-configuration.mov
20 Claude Sdk Configuration AUTHENTICATED (2 files) â† 20-2, 20-3 with -AUTHENTICATED tag
```

These should all be single chapter groups, not split.

---

#### The Fix

**Three rules:**

1. **Group by chapter NUMBER only** - ignore the name portion when grouping
2. **Use first file's name** - the chapter display name comes from sequence 1 (`XX-1-name`)
3. **Strip tags from display name** - remove uppercase words (tags like `AUTHENTICATED`, `CTA`)

---

#### Expected Result

**Before (broken):**
```
20 Claude Sdk Configuration (1 file)
20 Claude Sdk Configuration AUTHENTICATED (2 files)
```

**After (fixed):**
```
20 Claude Sdk Configuration (3 files)
    20-1-claude-sdk-configuration.mov
    20-2-claude-sdk-configuration-AUTHENTICATED.mov
    20-3-claude-sdk-configuration-AUTHENTICATED.mov
```

---

#### Implementation

**Grouping logic:**
```typescript
// Extract chapter number only for grouping
const chapterNumber = parseInt(filename.split('-')[0], 10);

// Group all files with same chapter number together
const groups = groupBy(files, f => getChapterNumber(f.filename));
```

**Display name logic:**
```typescript
// Find first file in chapter (sequence 1)
const firstFile = chapterFiles.find(f => getSequence(f.filename) === 1) || chapterFiles[0];

// Extract name portion: "08-1-voz-boy-baker" â†’ "voz-boy-baker"
const namePortion = extractName(firstFile.filename);

// Remove tags (uppercase words)
const displayName = namePortion
  .split('-')
  .filter(word => word !== word.toUpperCase()) // Remove fully uppercase words
  .join('-');

// Title case for display: "voz-boy-baker" â†’ "Voz Boy Baker"
const chapterTitle = toTitleCase(displayName);
```

---

#### Files to Modify

- `client/src/components/RecordingsView.tsx` - chapter grouping logic
- Possibly `server/src/routes/recordings.ts` if grouping happens server-side

---

#### Part B: Total Duration Display

Show total video duration in two locations on the Recordings page:

**Location 1 - Header area** (near the file count):
```
83 files (6 active, 77 safe) | 1h 23m 45s
```

**Location 2 - Footer**:
```
Total: 1h 23m 45s
```

**Source:** Sum the duration of all chapters (duration data already exists from chapter timestamps).

---

#### Acceptance Criteria

- [ ] All files with same chapter number grouped together
- [ ] Chapter heading uses name from first file (sequence 1)
- [ ] Tags (uppercase words like AUTHENTICATED, CTA) stripped from heading
- [ ] File count shows total files in chapter
- [ ] Combine button still works correctly with grouped files
- [ ] Total duration displayed in header (near file count)
- [ ] Total duration displayed in footer

---

## Notes

- Add requirements in any format (FR, user story, bullet point)
- Will be categorized into features when patterns emerge
- Priority and grouping TBD

---

### FR-64: Inbox File Viewer

**As a user**, I want to view text-based files (.md, .json, .html, .txt, etc.) from the inbox tab in a modal viewer, so I can review content without leaving FliHub.

#### Features

- Click on viewable files (.md, .json, .html, .txt, .css, .js, .ts, .yaml, .yml, .xml) to open modal
- Viewable files shown in blue with hover state
- HTML files get "Open in browser" button
- Copy to clipboard button
- Open folder button
- Escape key closes modal

#### Files Modified

**Server:**
- `server/src/routes/query.ts` - GET /api/query/projects/:code/inbox/:subfolder/:filename
- `server/src/routes/system.ts` - POST /api/system/open-file

**Client:**
- `client/src/components/shared/FileViewerModal.tsx` - NEW
- `client/src/components/shared/index.ts` - export
- `client/src/components/TranscriptModal.tsx` - refactored to use FileViewerModal
- `client/src/components/InboxPage.tsx` - click handler, modal rendering
- `client/src/hooks/useApi.ts` - useInboxFileContent, useOpenInboxFile hooks
- `client/src/hooks/useOpenFolder.ts` - 'inbox' to FolderKey

**Shared:**
- `shared/types.ts` - FileContentResponse interface
- `client/src/constants/queryKeys.ts` - inboxFile query key

---

### NFR-65: Extract Shared Server Utilities

**Priority:** High | **Effort:** Small (1 hour)

**Problem:** Code duplication in server routes creates maintenance burden and bug risk.

#### Scope

1. **Transcript file filtering** - 6 locations filter .txt files excluding -chapter.txt
2. **Tag extraction** - 4 locations parse uppercase tags from filenames

#### Acceptance Criteria

- [ ] Create `getTranscriptBasenames(dir)` utility in `server/src/utils/scanning.ts`
- [ ] Create `extractTagsFromName(name)` utility in `shared/naming.ts`
- [ ] Replace all duplicated code with utility calls
- [ ] No changes to API responses
- [ ] Server and client build without errors

**Technical details:** See `refactoring-backlog.md` REF-1 and REF-2

---

### NFR-66: Consolidate TypeScript Response Types

**Priority:** High | **Effort:** Medium (1-2 hours)

**Problem:** Same response types defined in multiple places risk drift and type safety issues.

#### Types to Consolidate

| Type | Current Location |
|------|------------------|
| InboxFile, InboxSubfolder | query.ts AND useApi.ts |
| SafeResponse, RestoreResponse | useApi.ts only |
| Query types (QueryRecording, etc.) | query.ts only |

#### Acceptance Criteria

- [ ] Move all Query API types to `shared/types.ts`
- [ ] Move response types (SafeResponse, RestoreResponse, InboxFile, InboxSubfolder) to `shared/types.ts`
- [ ] Server routes import from shared
- [ ] Client hooks import from shared
- [ ] No duplicate type definitions remain
- [ ] TypeScript builds without errors

**Technical details:** See `refactoring-backlog.md` REF-3

---

### NFR-67: Standardize Server Error Handling

**Priority:** Medium | **Effort:** Medium (2 hours)

**Problem:** Error handling is inconsistent across server routes - some errors silently swallowed, some logged but not returned, different response formats.

#### Acceptance Criteria

- [ ] Create `readDirSafe(path)` utility - returns empty array for missing dirs, throws for real errors
- [ ] Create `sendErrorResponse(res, status, message)` helper for consistent error responses
- [ ] Replace 15+ silent catches in query.ts with appropriate handling
- [ ] Actual errors logged, expected conditions (missing dir) silent
- [ ] Consistent error response format: `{ success: false, error: string }`

**Technical details:** See `refactoring-backlog.md` REF-5 and REF-6

---

### NFR-68: Split Query Routes into Sub-Modules

**Priority:** Medium | **Effort:** Large (3-4 hours)
**Depends on:** NFR-66 (types should be consolidated first)

**Problem:** `server/src/routes/query.ts` is 1,352 lines containing 9 endpoints. Hard to navigate, test, and maintain.

#### Target Structure

```
server/src/routes/query/
â”œâ”€â”€ index.ts           # Router setup, composes sub-routers
â”œâ”€â”€ projects.ts        # /projects, /projects/resolve, /projects/:code
â”œâ”€â”€ recordings.ts      # /projects/:code/recordings
â”œâ”€â”€ transcripts.ts     # /projects/:code/transcripts
â”œâ”€â”€ chapters.ts        # /projects/:code/chapters
â”œâ”€â”€ images.ts          # /projects/:code/images
â”œâ”€â”€ export.ts          # /projects/:code/export
â””â”€â”€ inbox.ts           # /projects/:code/inbox endpoints
```

#### Acceptance Criteria

- [ ] Create `server/src/routes/query/` directory
- [ ] Split into logical files (~100-200 lines each)
- [ ] Create index.ts that composes sub-routers
- [ ] All endpoints function identically (no API changes)
- [ ] Server builds and runs without errors

**Technical details:** See `refactoring-backlog.md` REF-4
